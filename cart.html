<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Shrinxa â€“ Premium Packaging Solutions</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/><meta content="Shrinxa is a GTA-based supplier of stretch wrap, pre-stretch film, and packaging tape with free delivery over $300 and wholesale pricing for warehouses and 3PLs." name="description"/>
<style>
    :root {
      --bg: #050914;
      --bg-alt: #0b1224;
      --accent: #1ea6ff;
      --accent-soft: rgba(30,166,255,0.12);
      --accent-strong: #0b84d1;
      --text-main: #f5f7fb;
      --text-muted: #b6bfd8;
      --card-bg: #111729;
      --border-subtle: #20273b;
      --danger: #ff4e6a;
      --success: #4cd964;
    }
    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #16345e 0, #050914 55%);
      color: var(--text-main);
      line-height: 1.5;
    }
    a { color: inherit; text-decoration: none; }
    img { max-width: 100%; display: block; }

    header {
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(18px);
      background: linear-gradient(90deg, rgba(5,9,20,0.96), rgba(8,16,40,0.96));
      border-bottom: 1px solid rgba(46,56,86,0.8);
    }
    .nav-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0.75rem 1.25rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1.25rem;
    }
    .nav-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .nav-logo {
      width: 44px;
      height: 44px;
      border-radius: 999px;
      overflow: hidden;
      box-shadow: 0 0 0 2px rgba(30,166,255,0.35);
      background: #ffffff;
      padding: 4px;
    }
    .nav-logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    .nav-brand-text {
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }
    .nav-brand-text strong {
      letter-spacing: 0.14em;
      font-size: 0.9rem;
    }
    .nav-brand-text span {
      font-size: 0.75rem;
      color: var(--text-muted);
    }
    .nav-links {
      display: flex;
      gap: 1.25rem;
      font-size: 0.9rem;
      color: var(--text-muted);
      align-items: center;
    }
    .nav-links a {
      position: relative;
      padding-bottom: 0.15rem;
    }
    .nav-links a::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--accent), #47e7ff);
      border-radius: 999px;
      transition: width 0.2s ease-out;
    }
    .nav-links a:hover::after {
      width: 100%;
    }
    .cart-chip {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.35rem 0.9rem;
      border-radius: 999px;
      background: rgba(12,25,52,0.95);
      border: 1px solid rgba(71,143,255,0.7);
      box-shadow: 0 0 0 1px rgba(16,85,204,0.4);
      font-size: 0.8rem;
      cursor: pointer;
      white-space: nowrap;
    }
    .cart-chip span.badge {
      min-width: 20px;
      height: 20px;
      border-radius: 999px;
      background: var(--accent);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 600;
      color: #001225;
    }

    main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1.75rem 1.25rem 3.5rem;
    }

    .hero {
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) minmax(0, 1.1fr);
      gap: 2.5rem;
      align-items: center;
      padding: 1.5rem 1.5rem 2.25rem;
      margin-bottom: 2.3rem;
      border-radius: 1.5rem;
      background: radial-gradient(circle at 0 0, rgba(82,180,255,0.16), transparent 60%),
                  radial-gradient(circle at 100% 100%, rgba(111,66,193,0.25), transparent 55%),
                  linear-gradient(135deg, #050814, #050814);
      border: 1px solid rgba(72,92,140,0.65);
      box-shadow:
        0 28px 80px rgba(0,0,0,0.7),
        0 0 0 1px rgba(103,135,255,0.25);
    }
    .hero-kicker {
      font-size: 0.8rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--accent);
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
    }
    .hero-kicker::before {
      content: "";
      width: 18px;
      height: 1px;
      background: linear-gradient(90deg, rgba(71,143,255,0), rgba(71,143,255,1));
      border-radius: 999px;
    }
    .hero h1 {
      font-size: 1.8rem; /* Reduced from clamp(2.3rem, 4vw, 2.9rem) */
      margin: 0.2rem 0 0.4rem; /* Reduced margin */
      letter-spacing: 0.03em;
    }
    .hero h1 span.accent {
      background: linear-gradient(90deg, #39c9ff, #e1f5ff);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    .hero p.lede {
      margin: 0;
      color: var(--text-muted);
      max-width: 32rem;
      font-size: 0.98rem;
    }
    .hero-cta {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-top: 1.4rem;
      align-items: center;
    }
    .btn-primary,
    .btn-ghost {
      border-radius: 999px;
      padding: 0.7rem 1.35rem;
      font-size: 0.9rem;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      font-weight: 500;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      color: #001225;
      box-shadow: 0 14px 35px rgba(22,128,219,0.6);
    }
    .btn-primary:hover { filter: brightness(1.07); }
    .btn-ghost {
      background: transparent;
      color: var(--text-muted);
      border: 1px solid rgba(88,115,178,0.8);
    }

    .hero-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 1.1rem;
      margin-top: 1.3rem;
      font-size: 0.78rem;
      color: var(--text-muted);
    }
    .hero-meta span {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }
    .hero-meta span::before {
      content: "â€¢";
      color: var(--accent);
    }

    .hero-visual {
      justify-self: center;
      position: relative;
    }
    .hero-orbit {
      width: 260px;
      height: 260px;
      border-radius: 999px;
      background: #ffffff;
      box-shadow:
        0 0 0 1px rgba(117,160,255,0.4),
        0 26px 70px rgba(0, 0, 0, 0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    .hero-orbit img {
      width: 85%;
      height: 85%;
      object-fit: contain;
      filter: drop-shadow(0 10px 25px rgba(0,0,0,0.9));
    }
    .hero-orbit::after {
      content: "";
      position: absolute;
      inset: 15%;
      border-radius: inherit;
      border: 1px dashed rgba(209,233,255,0.18);
    }
    .hero-badge {
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      padding: 0.4rem 0.9rem;
      border-radius: 999px;
      background: rgba(5,9,20,0.96);
      border: 1px solid rgba(111,178,255,0.7);
      font-size: 0.72rem;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      white-space: nowrap;
    }
    .hero-badge span.dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--success);
      box-shadow: 0 0 0 4px rgba(76,217,100,0.25);
    }

    .factory-hero {
      display: grid;
      grid-template-columns: minmax(0, 1.6fr) minmax(0, 1.2fr);
      gap: 1.7rem;
      margin-bottom: 2.4rem;
      align-items: center;
    }
    .factory-image-wrap {
      border-radius: 1.25rem;
      overflow: hidden;
      border: 1px solid rgba(74,108,180,0.95);
      box-shadow: 0 26px 70px rgba(0,0,0,0.9);
    }
    .factory-image-wrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .factory-copy h2 {
      margin: 0 0 0.4rem;
      font-size: 1.45rem;
    }
    .factory-copy p {
      margin: 0.25rem 0;
      color: var(--text-muted);
      font-size: 0.9rem;
    }
    .factory-points {
      margin-top: 0.7rem;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 0.6rem;
      font-size: 0.82rem;
      color: var(--text-muted);
    }
    .factory-points div {
      padding: 0.35rem 0.6rem;
      border-radius: 0.7rem;
      background: rgba(8,16,40,0.98);
      border: 1px solid rgba(54,82,150,0.9);
    }

    section { margin-bottom: 2.75rem; }
    section h2 {
      font-size: 1.6rem;
      margin-bottom: 0.4rem;
    }
    section p.section-lede {
      margin-top: 0.1rem;
      color: var(--text-muted);
      font-size: 0.9rem;
      max-width: 38rem;
    }

    .filters-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin: 1.25rem 0 1.6rem;
    }
    .pill {
      border-radius: 999px;
      border: 1px solid rgba(92,117,170,0.9);
      padding: 0.35rem 0.95rem;
      font-size: 0.8rem;
      color: var(--text-muted);
      background: rgba(10,17,39,0.9);
      cursor: pointer;
    }
    .pill.active {
      background: var(--accent-soft);
      color: var(--accent);
      border-color: rgba(87,186,255,0.95);
    }

    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1.4rem;
    }
    .product-card {
      border-radius: 1rem;
      background: radial-gradient(circle at 0 0, rgba(74,140,232,0.18), transparent 55%),
                  var(--card-bg);
      padding: 1rem;
      border: 1px solid rgba(37,51,86,0.95);
      box-shadow: 0 16px 38px rgba(0,0,0,0.7);
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }
    .prod-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 0.75rem;
    }
    .prod-name { font-weight: 600; font-size: 1rem; }
    .prod-category {
      font-size: 0.75rem;
      padding: 0.1rem 0.55rem;
      border-radius: 999px;
      background: rgba(13,25,54,0.9);
      border: 1px solid rgba(108,141,208,0.9);
      color: var(--text-muted);
      white-space: nowrap;
    }
    .prod-image-wrap {
      margin-top: 0.25rem;
      background: radial-gradient(circle at 50% 0, rgba(180,230,255,0.18), transparent 65%);
      border-radius: 0.8rem;
      border: 1px solid rgba(40,60,110,0.9);
      padding: 0.45rem;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 130px;
    }
    .prod-image-wrap img {
      max-height: 110px;
      object-fit: contain;
    }
    .prod-spec { font-size: 0.8rem; color: var(--text-muted); }
    .prod-desc {
      font-size: 0.82rem;
      color: var(--text-muted);
      margin-top: 0.1rem;
    }
    .prod-features {
      margin: 0.2rem 0 0;
      padding-left: 1.1rem;
      font-size: 0.8rem;
      color: var(--text-muted);
    }
    .prod-features li {
      margin-bottom: 0.15rem;
    }
    .prod-prices {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      font-size: 0.82rem;
      margin-top: 0.3rem;
    }
    .price-chip {
      border-radius: 999px;
      padding: 0.25rem 0.65rem;
      background: rgba(11,21,46,0.9);
      border: 1px solid rgba(78,109,180,0.95);
    }
    .price-chip strong { margin-left: 0.2rem; }
    .prod-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.75rem;
      font-size: 0.78rem;
      color: var(--text-muted);
    }
    .prod-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
      align-items: center;
    }
    .qty-input {
      width: 70px;
      padding: 0.35rem 0.35rem;
      border-radius: 0.45rem;
      border: 1px solid rgba(87,116,178,0.9);
      background: rgba(5,10,26,0.95);
      color: var(--text-main);
      font-size: 0.8rem;
    }
    .qty-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(61,164,255,0.7);
    }
    .btn-add {
      flex: 1;
      border-radius: 0.55rem;
      border: none;
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      color: #001225;
      padding: 0.45rem 0.8rem;
      font-size: 0.85rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
      font-weight: 600;
    }
    .btn-add:hover { filter: brightness(1.05); }

    .about {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.3fr);
      gap: 2rem;
      align-items: center;
      padding: 1.5rem;
      border-radius: 1.25rem;
      background: linear-gradient(130deg, rgba(17,33,70,0.98), #050814);
      border: 1px solid rgba(69,101,177,0.9);
      box-shadow: 0 24px 60px rgba(0,0,0,0.85);
    }
    .about p {
      font-size: 0.9rem;
      color: var(--text-muted);
    }
    .about-list {
      margin-top: 0.6rem;
      padding-left: 1.1rem;
      font-size: 0.84rem;
      color: var(--text-muted);
    }
    .about-list li { margin-bottom: 0.2rem; }

    .why-strip {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
      margin-top: 1.1rem;
    }
    .why-card {
      padding: 0.8rem 0.9rem;
      border-radius: 0.9rem;
      background: rgba(8,16,40,0.97);
      border: 1px solid rgba(56,84,152,0.95);
      font-size: 0.82rem;
      color: var(--text-muted);
    }
    .why-card h3 {
      font-size: 0.9rem;
      margin: 0 0 0.25rem;
    }

    .delivery {
      padding: 1.5rem 1.3rem;
      border-radius: 1.2rem;
      background: radial-gradient(circle at 0 0, rgba(64,148,255,0.18), transparent 60%),
                  rgba(8,16,40,0.97);
      border: 1px solid rgba(63,95,170,0.95);
      box-shadow: 0 22px 60px rgba(0,0,0,0.85);
    }
    .delivery h2 {
      margin-top: 0;
      margin-bottom: 0.4rem;
    }
    .delivery-body {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin-bottom: 0.75rem;
    }
    .delivery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 0.5rem;
      font-size: 0.85rem;
    }
    .delivery-pill {
      padding: 0.35rem 0.7rem;
      border-radius: 999px;
      background: rgba(5,12,32,0.98);
      border: 1px solid rgba(74,110,187,0.95);
      color: var(--text-muted);
    }
    .delivery-extra {
      margin-top: 0.9rem;
      font-size: 0.86rem;
      color: var(--text-muted);
    }
    .delivery-extra strong {
      color: var(--accent);
    }

    .contact-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.4fr);
      gap: 1.6rem;
      align-items: flex-start;
    }
    .contact-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.2rem;
    }
    .contact-card {
      border-radius: 0.9rem;
      padding: 0.9rem 1rem;
      background: rgba(10,17,39,0.97);
      border: 1px solid rgba(63,87,145,0.95);
      font-size: 0.86rem;
      color: var(--text-muted);
    }
    .contact-card strong {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--text-main);
      display: block;
      margin-bottom: 0.3rem;
    }
    .contact-card a { color: var(--accent); }

    .quote-card {
      border-radius: 1rem;
      padding: 1rem 1.2rem 1.1rem;
      background: rgba(8,16,40,0.97);
      border: 1px solid rgba(74,110,187,0.95);
      box-shadow: 0 18px 50px rgba(0,0,0,0.85);
      font-size: 0.86rem;
    }
    .quote-card h3 {
      margin: 0 0 0.3rem;
      font-size: 1.1rem;
    }
    .quote-card p {
      margin: 0 0 0.6rem;
      color: var(--text-muted);
    }
    .quote-form {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.6rem 0.9rem;
      margin-top: 0.4rem;
      font-size: 0.84rem;
    }
    .quote-form .full {
      grid-column: 1 / -1;
    }
    .quote-label {
      display: block;
      margin-bottom: 0.18rem;
      color: var(--text-muted);
    }
    .quote-input,
    .quote-select,
    .quote-textarea {
      width: 100%;
      border-radius: 0.5rem;
      border: 1px solid rgba(78,108,176,0.95);
      background: rgba(5,10,26,0.96);
      color: var(--text-main);
      padding: 0.4rem 0.55rem;
      font-size: 0.86rem;
    }
    .quote-textarea {
      min-height: 80px;
      resize: vertical;
    }
    .quote-input:focus,
    .quote-select:focus,
    .quote-textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(61,164,255,0.7);
    }
    .quote-helper {
      margin-top: 0.55rem;
      font-size: 0.8rem;
      color: var(--text-muted);
    }
    .quote-helper a {
      color: var(--accent);
      text-decoration: none;
    }
    .quote-helper a:hover {
      text-decoration: underline;
    }
    .quote-submit {
      margin-top: 0.6rem;
      border-radius: 999px;
      border: none;
      padding: 0.55rem 1.2rem;
      font-size: 0.9rem;
      font-weight: 600;
      background: linear-gradient(130deg, var(--accent), var(--accent-strong));
      color: #001225;
      cursor: pointer;
    }

    footer {
      border-top: 1px solid rgba(40,57,102,0.9);
      padding: 1rem 1.25rem 1.5rem;
      font-size: 0.8rem;
      color: var(--text-muted);
      text-align: center;
      background: #050814;
    }

    .cart-panel {
      position: fixed;
      right: 0;
      top: 0;
      bottom: 0;
      width: min(360px, 100%);
      background: #050814;
      border-left: 1px solid rgba(63,87,145,0.95);
      box-shadow: -24px 0 80px rgba(0,0,0,0.9);
      transform: translateX(100%);
      transition: transform 0.25s ease-out;
      z-index: 40;
      display: flex;
      flex-direction: column;
    }
    .cart-panel.open { transform: translateX(0); }
    .cart-header {
      padding: 0.9rem 1rem;
      border-bottom: 1px solid rgba(45,61,102,0.95);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.75rem;
    }
    .cart-close {
      border-radius: 999px;
      width: 28px;
      height: 28px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border: 1px solid rgba(84,112,173,0.95);
      background: rgba(10,18,40,0.96);
      color: var(--text-muted);
      cursor: pointer;
      font-size: 1rem;
    }
    .cart-body {
      padding: 0.75rem 1rem 1rem;
      overflow-y: auto;
      flex: 1;
      font-size: 0.85rem;
    }
    .cart-empty {
      margin-top: 1rem;
      color: var(--text-muted);
      font-size: 0.85rem;
    }
    .cart-item {
      border-radius: 0.65rem;
      padding: 0.55rem 0.55rem 0.6rem;
      border: 1px solid rgba(63,87,145,0.95);
      background: rgba(8,16,40,0.97);
      margin-bottom: 0.5rem;
    }
    .cart-item-header {
      display: flex;
      justify-content: space-between;
      gap: 0.5rem;
    }
    .cart-footer {
      border-top: 1px solid rgba(45,61,102,0.95);
      padding: 0.75rem 1rem 1rem;
      font-size: 0.85rem;
      background: #050814;
    }
    .cart-summary-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      column-gap: 0.75rem;
      margin-bottom: 0.25rem;
    }
    .cart-summary-row.total { font-weight: 600; }
    .cart-summary-note {
      margin-top: 0.35rem;
      font-size: 0.78rem;
      color: var(--text-muted);
    }
    .cart-summary-note strong {
      color: var(--accent);
    }
    .cart-checkout-btn {
      margin-top: 0.6rem;
      width: 100%;
      border-radius: 0.75rem;
      border: none;
      padding: 0.6rem 0.9rem;
      font-size: 0.9rem;
      font-weight: 600;
      background: linear-gradient(130deg, var(--accent), var(--accent-strong));
      color: #001225;
      cursor: pointer;
    }

    .toast {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      padding: 0.55rem 0.9rem;
      border-radius: 999px;
      background: rgba(4,16,36,0.98);
      border: 1px solid rgba(76,126,206,0.95);
      font-size: 0.8rem;
      color: var(--text-muted);
      opacity: 0;
      transform: translateY(20px);
      pointer-events: none;
      transition: opacity 0.18s ease-out, transform 0.18s ease-out;
      z-index: 45;
    }
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    @media (max-width: 980px) {
      .factory-hero {
        grid-template-columns: minmax(0, 1fr);
      }
      .contact-layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    @media (max-width: 820px) {
      .hero {
        grid-template-columns: minmax(0, 1fr);
        text-align: left;
      }
      .hero-visual { order: -1; }
      .hero-orbit {
        width: 220px;
        height: 220px;
      }
      .nav-links { display: none; }
    }
    @media (max-width: 480px) {
      main { padding-inline: 0.9rem; }
      .hero { padding: 1.1rem 1rem 1.7rem; }
      .product-card { padding: 0.85rem; }
    }
  
    .pricing-note {
      margin-top: 0.6rem;
      font-size: 0.82rem;
      color: var(--text-muted);
      padding: 0.55rem 0.8rem;
      border-radius: 0.75rem;
      background: rgba(7,14,36,0.98);
      border: 1px dashed rgba(87,138,226,0.9);
    }
    .pricing-note strong {
      color: var(--accent);
    }
    
    .qty-note {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-right: 0.15rem;
    }
    
    .nav-dropdown {
      position: relative;
      display: flex;
      align-items: center;
    }
    .nav-dropdown-toggle {
      background: none;
      border: none;
      color: var(--text-muted);
      font: inherit;
      cursor: pointer;
      padding: 0;
      display: flex;
      align-items: center;
      gap: 0.2rem;
    }
    .nav-dropdown-toggle:hover {
      color: var(--text-main);
    }
    .nav-dropdown-menu {
      position: absolute;
      top: 150%;
      left: 0;
      background: rgba(5,9,20,0.98);
      border-radius: 0.75rem;
      padding: 0.4rem 0.35rem;
      box-shadow: 0 18px 40px rgba(0,0,0,0.55);
      display: none;
      flex-direction: column;
      min-width: 180px;
      z-index: 40;
      border: 1px solid rgba(65,98,160,0.7);
    }
    .nav-dropdown-menu.open {
      display: flex;
    }
    .nav-dropdown-item {
      background: none;
      border: none;
      color: var(--text-muted);
      text-align: left;
      padding: 0.35rem 0.75rem;
      border-radius: 0.55rem;
      font-size: 0.85rem;
      cursor: pointer;
      white-space: nowrap;
    }
    .nav-dropdown-item:hover {
      background: var(--accent-soft);
      color: var(--text-main);
    }

    .prod-main {
      flex: 1 1 auto;
      display: flex;
      flex-direction: column;
    }
    .prod-main .prod-prices {
      margin-top: auto;
    }

    .delivery-list {
      margin: 1rem 0 1.5rem 0;
      padding-left: 1.2rem;
      font-size: 0.95rem;
      color: var(--text-muted);
      max-width: 720px;
    }
    .delivery-list li {
      margin-bottom: 0.4rem;
    }

    .nav-right {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .user-menu {
      position: relative;
      display: none;
      align-items: center;
    }
    .user-menu-toggle {
      background: none;
      border: 1px solid rgba(74,94,140,0.9);
      border-radius: 999px;
      padding: 0.3rem 0.75rem;
      font-size: 0.8rem;
      color: var(--text-muted);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      background: rgba(3,7,20,0.9);
    }
    .user-menu-toggle:hover {
      color: var(--text-main);
      border-color: var(--accent);
    }
    .user-menu-dropdown {
      position: absolute;
      top: 130%;
      right: 0;
      background: rgba(5,9,20,0.98);
      border-radius: 0.75rem;
      padding: 0.35rem 0.35rem;
      box-shadow: 0 18px 40px rgba(0,0,0,0.55);
      display: none;
      flex-direction: column;
      min-width: 180px;
      z-index: 50;
      border: 1px solid rgba(65,98,160,0.7);
    }
    .user-menu-dropdown.open {
      display: flex;
    }
    .user-menu-item {
      background: none;
      border: none;
      color: var(--text-muted);
      text-align: left;
      padding: 0.35rem 0.75rem;
      border-radius: 0.55rem;
      font-size: 0.85rem;
      cursor: pointer;
      white-space: nowrap;
      width: 100%;
    }
    .user-menu-item:hover {
      background: var(--accent-soft);
      color: var(--text-main);
    }
    .user-greeting {
      font-size: 0.8rem;
      color: var(--text-muted);
      white-space: nowrap;
      min-width: 0;
    }
    .user-greeting span {
      color: var(--accent);
      font-weight: 500;
    }
    .signin-section {
      padding: 3rem 0 3.5rem 0;
    }
    .auth-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 1.75rem;
    }
    .auth-card {
      background: rgba(7, 14, 36, 0.97);
      border-radius: 1.2rem;
      padding: 1.5rem 1.6rem;
      border: 1px solid rgba(65, 98, 160, 0.85);
      box-shadow: 0 18px 50px rgba(0,0,0,0.75);
      font-size: 0.86rem;
      color: var(--text-muted);
    }
    .auth-card h3 {
      margin: 0 0 0.35rem;
      font-size: 1.05rem;
      color: var(--text-main);
    }
    .auth-intro {
      margin: 0 0 0.7rem;
      font-size: 0.86rem;
      color: var(--text-muted);
    }
    .auth-form {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.6rem 0.9rem;
    }
    .auth-form .full-row {
      grid-column: 1 / -1;
    }
    .auth-label {
      display: block;
      margin-bottom: 0.2rem;
      font-size: 0.8rem;
      color: var(--text-muted);
    }
    .auth-input,
    .auth-select {
      width: 100%;
      border-radius: 0.55rem;
      border: 1px solid rgba(78, 108, 176, 0.95);
      background: rgba(5, 10, 26, 0.96);
      color: var(--text-main);
      padding: 0.4rem 0.55rem;
      font-size: 0.85rem;
    }
    .auth-input:focus,
    .auth-select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(61,164,255,0.7);
    }
    .auth-check {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.8rem;
      margin-top: 0.4rem;
    }
    .auth-check input {
      width: auto;
      margin: 0;
    }
    .auth-actions {
      margin-top: 0.7rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      align-items: center;
    }
    .auth-submit {
      border-radius: 999px;
      border: none;
      padding: 0.55rem 1.2rem;
      font-size: 0.88rem;
      font-weight: 600;
      background: linear-gradient(130deg, var(--accent), var(--accent-strong));
      color: #001225;
      cursor: pointer;
    }
    .auth-note {
      font-size: 0.78rem;
      color: var(--text-muted);
    }
    .auth-footnote {
      margin-top: 0.6rem;
      font-size: 0.78rem;
      color: var(--text-muted);
    }
    .auth-footnote strong {
      color: var(--accent);
    }
    @media (max-width: 900px) {
      .auth-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }
    .cart-summary-row select#cart-payment {
      font-size: 0.8rem;
      padding: 0.25rem 0.4rem;
      border-radius: 0.5rem;
      border: 1px solid rgba(74,94,140,0.9);
      background: rgba(3,7,20,0.9);
      color: var(--text-main);
    }

.signin-section > * {
  max-width:1100px;
  margin-left:auto;
  margin-right:auto;
  padding-left:1.5rem;
  padding-right:1.5rem;
}

/* ADMIN PAGE */
.admin-section {
  margin-top: 2.5rem;
}

.admin-customers-grid {
  margin-top: 1.2rem;
  display: grid;
  grid-template-columns: minmax(0, 1fr);
  gap: 1rem;
}

.admin-customer-card {
  border-radius: 0.9rem;
  background: rgba(8,16,40,0.95);
  border: 1px solid rgba(60,95,170,0.9);
  padding: 0.9rem;
  box-shadow: 0 16px 40px rgba(0,0,0,0.8);
  font-size: 0.85rem;
}

.admin-customer-header {
  display: flex;
  flex-direction: column;
  gap: 0.1rem;
  margin-bottom: 0.6rem;
}

.admin-customer-name {
  font-weight: 600;
}

.admin-customer-email {
  color: var(--text-muted);
  font-size: 0.8rem;
}

.admin-customer-fields {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 0.6rem;
  margin-bottom: 0.7rem;
}

.admin-customer-fields label {
  display: flex;
  flex-direction: column;
  gap: 0.15rem;
  font-size: 0.8rem;
  color: var(--text-muted);
}

.admin-customer-fields select,
.admin-customer-fields input {
  font-size: 0.82rem;
  padding: 0.25rem 0.4rem;
  border-radius: 0.5rem;
  border: 1px solid rgba(74,94,140,0.9);
  background: rgba(3,7,20,0.9);
  color: var(--text-main);
}

.admin-customer-card .admin-save-btn {
  margin-top: 0.3rem;
  font-size: 0.8rem;
  padding: 0.4rem 0.9rem;
}

.admin-customer-platinum {
  margin-top: 0.8rem;
  border-top: 1px solid rgba(60,95,170,0.9);
  padding-top: 0.7rem;
}

.admin-customer-platinum h2,
.admin-customer-platinum h4 {
  margin: 0 0 0.5rem;
  font-size: 0.9rem;
}

.admin-prices-grid {
  display: grid;
  grid-template-columns: minmax(0, 1fr);
  gap: 0.35rem;
  max-height: 260px;
  overflow-y: auto;
}

.admin-price-row {
  display: grid;
  grid-template-columns: 2fr 1.1fr 1.1fr;
  gap: 0.4rem;
  align-items: center;
  font-size: 0.8rem;
}

.admin-price-row .apr-name {
  font-size: 0.8rem;
}

.admin-price-row .apr-field label {
  display: flex;
  flex-direction: column;
  gap: 0.1rem;
}

.admin-price-row input {
  font-size: 0.8rem;
  padding: 0.18rem 0.32rem;
  border-radius: 0.4rem;
  border: 1px solid rgba(74,94,140,0.9);
  background: rgba(3,7,20,0.95);
  color: var(--text-main);
}


    @page {
      size: A4;
      margin: 12mm;
    }

    @media print {

    body {
        background: url('shrinxa_transparent_4000px.png') center center no-repeat !important;
        background-size: 60% auto !important;
        opacity: 1 !important;
    }
    
  * {
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
  html, body {
    background: #ffffff !important;
    margin: 0 !important;
    padding: 0 !important;
    height: auto !important;
  }
  body * {
    display: none !important;
  }
  #invoiceModal,
  #invoiceModal * {
    display: unset !important;
    visibility: visible !important;
  }
  #invoiceModal {
    display: block !important;
    position: static !important;
    inset: auto !important;
    background: #ffffff !important;
    box-shadow: none !important;
    padding: 0 !important;
    margin: 0 !important;
  }
  #invoiceModal .modal-card {
    box-shadow: none !important;
    border: none !important;
    max-width: 720px !important;
    width: 100% !important;
    margin: 0 auto !important;
    max-height: none !important;
    overflow: visible !important;
  }
  #invoiceModal .invoice-actions,
  #invoiceClose,
  #invoicePrint,
  #invoiceDownload {
    display: none !important;
  }
  @page {
    size: A4;
    margin: 12mm;
  }
}
    .dropdown-menu.open{display:block;}
</style>
<style>

    :root {
      --bg: #050914;
      --bg-alt: #0b1224;
      --accent: #1ea6ff;
      --accent-soft: rgba(30,166,255,0.12);
      --accent-strong: #0b84d1;
      --text-main: #f5f7fb;
      --text-muted: #b6bfd8;
      --card-bg: #111729;
      --border-subtle: #20273b;
      --danger: #ff4e6a;
      --success: #4cd964;
    }
    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #16345e 0, #050914 55%);
      color: var(--text-main);
      line-height: 1.5;
    }
    a { color: inherit; text-decoration: none; }
    img { max-width: 100%; display: block; }

    header {
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(18px);
      background: linear-gradient(90deg, rgba(5,9,20,0.96), rgba(8,16,40,0.96));
      border-bottom: 1px solid rgba(46,56,86,0.8);
    }
    .nav-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0.75rem 1.25rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1.25rem;
    }
    .nav-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .nav-logo {
      width: 44px;
      height: 44px;
      border-radius: 999px;
      overflow: hidden;
      box-shadow: 0 0 0 2px rgba(30,166,255,0.35);
      background: #ffffff;
      padding: 4px;
    }
    .nav-logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    .nav-brand-text {
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }
    .nav-brand-text strong {
      letter-spacing: 0.14em;
      font-size: 0.9rem;
    }
    .nav-brand-text span {
      font-size: 0.75rem;
      color: var(--text-muted);
    }
    .nav-links {
      display: flex;
      gap: 1.25rem;
      font-size: 0.9rem;
      color: var(--text-muted);
      align-items: center;
    }
    .nav-links a {
      position: relative;
      padding-bottom: 0.15rem;
    }
    .nav-links a::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--accent), #47e7ff);
      border-radius: 999px;
      transition: width 0.2s ease-out;
    }
    .nav-links a:hover::after {
      width: 100%;
    }
    .cart-chip {
      color: #f5f7fb;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.35rem 0.9rem;
      border-radius: 999px;
      background: rgba(12,25,52,0.95);
      border: 1px solid rgba(71,143,255,0.7);
      box-shadow: 0 0 0 1px rgba(16,85,204,0.4);
      font-size: 0.8rem;
      cursor: pointer;
      white-space: nowrap;
    }
    .cart-chip span.badge {
      color: #001225;
      min-width: 20px;
      height: 20px;
      border-radius: 999px;
      background: var(--accent);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 600;
      color: #001225;
    }

    main {

</style>
<style>
/* === HEADER BRAND UPGRADE (LOGO + NAME) === */
.nav-left{
  gap: 0.95rem;
}
.nav-logo{
  position: relative;
  box-shadow:
    0 0 0 2px rgba(30,166,255,0.45),
    0 14px 32px rgba(30,166,255,0.22),
    0 0 0 1px rgba(255,255,255,0.08) inset;
}
.nav-logo::after{
  content:"";
  position:absolute;
  inset:-10px;
  border-radius:999px;
  background: radial-gradient(circle at 30% 30%, rgba(71,231,255,0.28), transparent 55%),
              radial-gradient(circle at 70% 70%, rgba(111,66,193,0.22), transparent 60%);
  filter: blur(10px);
  opacity: .75;
  z-index:-1;
}
.nav-brand-text strong{
  font-size: 1.05rem;
  letter-spacing: 0.22em;
  background: linear-gradient(90deg, #39c9ff, #e1f5ff);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  text-shadow: 0 10px 24px rgba(0,0,0,0.45);
}
.nav-brand-text span{
  font-size: 0.78rem;
  color: rgba(182,191,216,0.92);
  letter-spacing: 0.02em;
}

/* Mobile: make brand feel premium + keep readable */
@media (max-width: 820px){
  .nav-inner{
    gap: 0.85rem;
  }
  .nav-logo{
    width: 46px;
    height: 46px;
  }
  .nav-brand-text strong{
    font-size: 1.02rem;
    letter-spacing: 0.18em;
  }
  .nav-brand-text span{
    font-size: 0.76rem;
  }
}

/* === HAMBURGER ICON: STACK BARS VERTICALLY === */
.mobile-menu-btn{
  flex-direction: column !important;
  gap: 5px !important;
}
</style>
<style>
/* === BRAND MOTION (LOGO + NAME) === */
@media (prefers-reduced-motion: no-preference) {
  .nav-left {
    position: relative;
  }

  .nav-logo {
    animation: brandGlow 3.8s ease-in-out infinite;
    transform-origin: center;
  }

  .nav-logo img {
    animation: brandFloat 4.6s ease-in-out infinite;
    transform-origin: center;
  }

  .nav-brand-text strong {
    position: relative;
  }

  .nav-brand-text strong::after{
    content:"";
    position:absolute;
    left:-8px;
    right:-8px;
    bottom:-2px;
    height:2px;
    border-radius:999px;
    background: linear-gradient(90deg, rgba(71,231,255,0), rgba(71,231,255,0.9), rgba(71,231,255,0));
    opacity:.0;
    animation: brandUnderline 3.8s ease-in-out infinite;
  }

  @keyframes brandGlow {
    0%,100% {
      box-shadow:
        0 0 0 2px rgba(30,166,255,0.45),
        0 14px 32px rgba(30,166,255,0.22),
        0 0 0 1px rgba(255,255,255,0.08) inset;
      filter: brightness(1);
      transform: translateY(0) scale(1);
    }
    50% {
      box-shadow:
        0 0 0 2px rgba(71,231,255,0.70),
        0 18px 46px rgba(71,143,255,0.32),
        0 0 0 1px rgba(255,255,255,0.10) inset;
      filter: brightness(1.05);
      transform: translateY(-1px) scale(1.02);
    }
  }

  @keyframes brandFloat {
    0%,100% { transform: translateY(0) scale(1); }
    50% { transform: translateY(-1.5px) scale(1.01); }
  }

  @keyframes brandUnderline {
    0%,100% { opacity: 0.05; transform: scaleX(0.6); }
    50% { opacity: 0.75; transform: scaleX(1); }
  }
}

/* Hover bonus (desktop only) */
@media (hover:hover) and (pointer:fine){
  .nav-left:hover .nav-logo{
    filter: brightness(1.08);
    transform: translateY(-2px) scale(1.03);
  }
}
</style>
<style>
/* === MOBILE HEADER MENU (RESTORED) === */
.mobile-menu-btn{
  display:none;
  width:42px;
  height:38px;
  border-radius: 12px;
  border: 1px solid rgba(71,143,255,0.6);
  background: rgba(12,25,52,0.75);
  box-shadow: 0 0 0 1px rgba(16,85,204,0.35);
  cursor:pointer;
  align-items:center;
  justify-content:center;
  flex-direction: column; /* bars on top of each other */
  gap: 5px;
}
.mobile-menu-btn .mm-bar{
  display:block;
  width:18px;
  height:2px;
  background: rgba(245,247,251,0.92);
  border-radius: 999px;
}

.mobile-menu-panel{
  display:none;
  position: fixed;
  top: 68px;
  left: 0;
  right: 0;
  z-index: 30;
  padding: 10px 12px 14px;
  background: linear-gradient(180deg, rgba(5,9,20,0.98), rgba(8,16,40,0.98));
  border-bottom: 1px solid rgba(46,56,86,0.8);
  backdrop-filter: blur(18px);
}
.mobile-menu-panel.open{ display:block; }

.mobile-menu-inner{
  max-width: 1200px;
  margin: 0 auto;
  display:flex;
  flex-direction:column;
  gap: 10px;
}
.mobile-menu-inner a,
.mobile-menu-group-btn{
  color: var(--text-main);
  text-decoration:none;
  font-size: 0.95rem;
  padding: 12px 12px;
  border-radius: 14px;
  border: 1px solid rgba(63,87,145,0.65);
  background: rgba(8,16,40,0.75);
}
.mobile-menu-inner a:hover,
.mobile-menu-group-btn:hover{
  border-color: rgba(87,186,255,0.95);
}
.mobile-menu-group{ display:flex; flex-direction:column; gap:10px; }
.mobile-menu-group-btn{
  width:100%;
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
}
.mobile-menu-sub{
  display:none;
  flex-direction:column;
  gap: 8px;
  padding-left: 6px;
}
.mobile-menu-sub.open{ display:flex; }
.mobile-menu-sub a{
  background: rgba(5,12,32,0.8);
  border-color: rgba(63,87,145,0.55);
  font-size: 0.92rem;
}

@media (max-width: 820px){
  .nav-links{ display:none !important; }
  .mobile-menu-btn{ display:inline-flex; }

  /* Keep everything INSIDE the screen (fix cart pushed right) */
  .nav-inner{
    padding: 0.65rem 0.9rem;
    gap: 0.6rem;
  }
  .nav-left{ min-width: 0; }
  .nav-brand-text{ min-width: 0; }
  .nav-brand-text span{ display: none; } /* hide subtitle on mobile to save space */
  .nav-brand-text strong{ white-space: nowrap; }

  .nav-right{
    min-width: 0;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 0.5rem;
    flex-wrap: wrap;           /* allows wrap instead of overflowing */
    row-gap: 6px;
  }

  /* Make the user pill compact */
  #user-greeting{ display:none !important; }
  .user-menu-toggle{
    max-width: 170px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    padding: 0.28rem 0.6rem;
    font-size: 0.78rem;
  }

  /* Make cart compact but keep blue style */
  .cart-chip{
    padding: 0.32rem 0.65rem;
    font-size: 0.78rem;
    max-width: 140px;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .nav-logo{ width:46px; height:46px; }
}
</style>
<style>
/* === CART PULSE LIKE INDEX (BUMP ANIMATION) === */
.cart-chip.bump{ animation: cartBump .28s ease-out; }
@keyframes cartBump{
  0%{transform:scale(1)}
  45%{transform:scale(1.12)}
  100%{transform:scale(1)}
}
</style>
<style>
/* === CART PAGE SCOPE (PREVENT HEADER STYLE COLLISIONS) === */
.cart-page button,
.cart-page input,
.cart-page select{
  font: inherit;
}
</style>


<style>
/* === CART1 VISUALS ONLY: ITEM HOVER + BUY NOW SHINE === */

/* Item hover motion (desktop pointer only) */
@media (hover:hover) and (pointer:fine){
  .cart-row{
    transition: transform 180ms ease, box-shadow 180ms ease, border-color 180ms ease, filter 180ms ease;
    will-change: transform;
  }
  .cart-row:hover{
    transform: translateY(-6px);
    border-color: rgba(87,186,255,0.95) !important;
    box-shadow: 0 22px 65px rgba(0,0,0,0.78), 0 0 0 1px rgba(71,231,255,0.18);
    filter: brightness(1.04);
  }
}

/* Buy now shine (best visual improvement) */
@media (prefers-reduced-motion: no-preference){
  #buyNowBtn{
    position: relative;
    overflow: hidden;
  }
  #buyNowBtn::after{
    content:"";
    position:absolute;
    top:-60%;
    left:-40%;
    width:40%;
    height:220%;
    transform: rotate(18deg);
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.70), transparent);
    opacity:0;
    animation: buyNowShine 4.8s ease-in-out infinite;
  }
  @keyframes buyNowShine{
    0%,76%,100%{opacity:0; transform: translateX(-140%) rotate(18deg);}
    82%{opacity:0.9;}
    92%{opacity:0.9; transform: translateX(420%) rotate(18deg);}
    96%{opacity:0;}
  }
  #buyNowBtn:disabled::after{ display:none; }
}
</style>

</head>
<body>
<header>
<div class="nav-inner">
<div class="nav-left">
<div class="nav-logo">
<img alt="Shrinxa logo" src="shrinxa_transparent_4000px.png"/>
</div>
<div class="nav-brand-text">
<strong>SHRINXA</strong>
<span>Premium Packaging Solutions</span>
</div>
</div>
<nav class="nav-links">
<a class="nav-anchor nav-home" data-nav="home" href="index.html">Home</a>
<div class="nav-dropdown">
  <button class="nav-dropdown-toggle" type="button" aria-haspopup="true" aria-expanded="false">
    Products <span aria-hidden="true">â–¾</span>
  </button>
  <div class="nav-dropdown-menu" role="menu">
    <a class="nav-dropdown-item" role="menuitem" href="products.html?cat=all">All Products</a>
    <a class="nav-dropdown-item" role="menuitem" href="products.html?cat=stretch">Stretch Wrap</a>
    <a class="nav-dropdown-item" role="menuitem" href="products.html?cat=prestretch">Pre-Stretch Wrap</a>
    <a class="nav-dropdown-item" role="menuitem" href="products.html?cat=tape">Tape Rolls</a>
  </div>
</div>
<a class="nav-anchor nav-about" data-nav="about" href="about.html">About</a>
<a class="nav-anchor nav-delivery" data-nav="delivery" href="delivery.html">Delivery</a>
<a class="nav-anchor nav-contact" data-nav="contact" href="contactus.html">Contact us</a>

<a class="nav-anchor nav-signin" data-nav="signin" href="login.html">Sign in</a></nav>
<div class="nav-right">
<button class="mobile-menu-btn" id="mobileMenuBtn" type="button" aria-label="Open menu" aria-expanded="false">
  <span class="mm-bar"></span>
  <span class="mm-bar"></span>
  <span class="mm-bar"></span>
</button>
<div class="user-menu" id="user-menu" style="display:none; position:relative;"><button class="user-menu-toggle" id="userMenuToggle" type="button"><span id="userMenuName">Profile</span> â–¾</button><div class="user-menu-dropdown" id="userMenuDropdown"><button class="user-menu-item" type="button" data-action="profile">Profile</button><button class="user-menu-item" type="button" data-action="history">Purchase History</button><button class="user-menu-item" type="button" data-action="signout">Sign out</button></div></div><div class="user-greeting" id="user-greeting"></div><button class="cart-chip" id="openCartBtn">
      ðŸ§º Cart <span class="badge" id="cartCount">0</span>
</button></div></div>
</header>
<div class="mobile-menu-panel" id="mobileMenuPanel" aria-hidden="true">
  <div class="mobile-menu-inner">
    <a href="index.html">Home</a>
    <div class="mobile-menu-group">
      <button class="mobile-menu-group-btn" type="button" id="mobileProductsBtn" aria-expanded="false">
        Products <span aria-hidden="true">â–¾</span>
      </button>
      <div class="mobile-menu-sub" id="mobileProductsSub">
        <a href="products.html?cat=all">All Products</a>
        <a href="products.html?cat=stretch">Stretch Wrap</a>
        <a href="products.html?cat=prestretch">Pre-Stretch Wrap</a>
        <a href="products.html?cat=tape">Tape Rolls</a>
      </div>
    </div>
    <a href="about.html">About</a>
    <a href="delivery.html">Delivery</a>
    <a href="contactus.html">Contact us</a>
    <a class="nav-signin" href="login.html">Sign in</a>
  </div>
</div>
<div class="cart-page">
<main class="container" style="padding-top: 40px;">
  <section class="hero" style="padding: 1rem 1.5rem 1.2rem; margin-bottom: 1.5rem;">
    <h1>Your Cart</h1>
    <p style="margin-top:4px;opacity:.9;font-size:0.85rem;">Items saved to your account.</p>
  </section>

  <section class="card-grid" style="margin-top:18px;">
    <div class="product-card" style="grid-column: 1 / -1;">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;">
        <h2 style="margin:0;font-size:20px;">Cart Items</h2>
        <div style="display:flex;gap:10px;align-items:center;">
          <button id="clearCartBtn" class="btn btn-secondary" type="button">Clear cart</button>
          <button id="continueShoppingBtn" class="btn btn-primary" type="button">Continue shopping</button>
        </div>
      </div>

      <div id="cartMsg" style="margin-top:12px;color:#c7d2fe;"></div>

      <div id="cartList" style="margin-top:10px;display:flex;flex-direction:column;gap:6px;"></div>

      <hr style="margin:16px 0; border:0; border-top:1px solid rgba(255,255,255,.08);" />

      <div style="display:flex;justify-content:flex-end;">
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 6px 12px; font-size: 0.9rem; min-width: 280px;">
          <div style="text-align:right;"><strong>Subtotal:</strong></div>
          <div style="text-align:right;" id="subTotal">$0.00</div>
          
          <div style="text-align:right;"><strong>Delivery:</strong></div>
          <div style="text-align:right;" id="deliveryFee">$0.00</div>
          
          <div style="text-align:right; border-top: 1px solid rgba(255,255,255,.15); padding-top: 6px;"><strong>HST (13%):</strong></div>
          <div style="text-align:right; border-top: 1px solid rgba(255,255,255,.15); padding-top: 6px;" id="hst">$0.00</div>
          
          <div style="text-align:right; font-size: 1.1rem;"><strong>Total:</strong></div>
          <div style="text-align:right; font-size: 1.1rem;" id="grandTotal">$0.00</div>
        
      <div style="display:flex;justify-content:flex-end;margin-top:14px;">
        <div style="display:flex;flex-direction:column;gap:10px;min-width:280px;">
          <div style="display:flex;justify-content:flex-end;gap:10px;align-items:center;flex-wrap:wrap;">
            <span style="font-size:0.85rem;opacity:.9;">Payment:</span>
            <select id="paymentMethod" style="min-width:190px;padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.18);background:rgba(0,0,0,.2);color:#fff;">
              <option value="pay_now">Pay now</option>
</select>
          </div>
          <button id="buyNowBtn" class="btn btn-primary" type="button" style="width:100%;">Buy now</button>
          <div id="checkoutMsg" style="text-align:right;font-size:0.85rem;color:#c7d2fe;"></div>
        </div>
      </div>

</div>
      </div>
    </div>
  </section>
</main>

<footer>
  Â© <span id="year"></span> Shrinxa. All rights reserved.
</footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
// Capture the SAME Supabase client created inside auth.js (without editing auth.js)
// auth.js runs AFTER this script tag, so we wrap createClient *immediately*.
(() => {
  if (!window.supabase || typeof window.supabase.createClient !== "function") return;
  if (window.__shrinxaCreateClientWrapped) return;
  window.__shrinxaCreateClientWrapped = true;
  const _orig = window.supabase.createClient.bind(window.supabase);
  window.supabase.createClient = (...args) => {
    const client = _orig(...args);
    window.supabaseClient = client;
    return client;
  };
})();

/* User dropdown + actions (about/contact/delivery/products) */
document.addEventListener("DOMContentLoaded", () => {
  const toggle = document.getElementById("userMenuToggle");
  const menu = document.getElementById("userMenuDropdown");
  if (!toggle || !menu) return;

  const closeMenu = () => menu.classList.remove("open");

  toggle.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();
    menu.classList.toggle("open");
  });

  document.addEventListener("click", (e) => {
    if (!menu.contains(e.target) && !toggle.contains(e.target)) closeMenu();
  });

  window.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closeMenu();
  });

  const profileBtn = menu.querySelector('[data-action="profile"]');
  const historyBtn = menu.querySelector('[data-action="history"]');
  const signOutBtn = menu.querySelector('[data-action="signout"]');

  profileBtn && profileBtn.addEventListener("click", (e) => {
    e.preventDefault();
    closeMenu();
    window.location.href = "index.html#profile";
  });

  historyBtn && historyBtn.addEventListener("click", (e) => {
    e.preventDefault();
    closeMenu();
    window.location.href = "index.html#history";
  });

  signOutBtn && signOutBtn.addEventListener("click", async (e) => {
    e.preventDefault();
    closeMenu();
    await doSignOut();
    window.location.href = "index.html";
  });
});

// --- Supabase sign out helper (NO auth.js edits) ---
async function getSupabaseClient() {
  if (window.supabaseClient?.auth) return window.supabaseClient;
  if (window._supabase?.auth) return window._supabase;
  if (window.supabase?.auth && !window.supabase.createClient) return window.supabase;

  if (!window.supabase || typeof window.supabase.createClient !== "function") return null;

  try {
    const res = await fetch("auth.js", { cache: "no-cache" });
    const txt = await res.text();

    const url =
      (txt.match(/supabaseUrl\s*=\s*['"]([^'"]+)['"]/i)?.[1]) ||
      (txt.match(/SUPABASE[_\s]?URL\s*=\s*['"]([^'"]+)['"]/i)?.[1]) ||
      (txt.match(/createClient\(\s*['"]([^'"]*supabase\.co[^'"]*)['"]/i)?.[1]);

    const key =
      (txt.match(/supabaseKey\s*=\s*['"]([^'"]+)['"]/i)?.[1]) ||
      (txt.match(/SUPABASE[_\s]?(ANON|PUBLIC)[_\s]?KEY\s*=\s*['"]([^'"]+)['"]/i)?.[2]) ||
      (txt.match(/createClient\([^,]+,\s*['"]([^'"]+)['"]/i)?.[1]);

    if (!url || !key) return null;

    const sb = window.supabase.createClient(url, key);
    window.supabaseClient = sb;
    return sb;
  } catch (e) {
    return null;
  }
}

async function doSignOut() {
  try {
    const sb = await getSupabaseClient();
    if (sb?.auth?.signOut) await sb.auth.signOut();
  } catch (e) {}
}
</script>

<script src="auth.js"></script>

<script>
(function(){
  function getSb(){
    return (window.ShrinxaAuth && window.ShrinxaAuth.supabaseClient) ||
           (window.Auth && window.Auth.supabaseClient) ||
           window.supabaseClient || window._supabase || window.supabase || null;
  }
  function money(n){ return "$" + (Number(n||0)).toFixed(2); }

  function pickQty(row){
    return Number(row.qty ?? row.quantity ?? 0) || 0;
  }
    let WHOLESALE_THRESHOLD = 50; // default fallback
let CUSTOMER_TIER = "standard"; // default fallback

let DELIVERY_RULE = { min_subtotal: 300, fee: 30 }; // fallback

async function loadDeliveryRule(sb){
  try{
    // get logged-in user
    const { data: u } = await sb.auth.getUser();
    const uid = u?.user?.id || null;

    // 1) try customer override first
    if (uid) {
      const { data: cust } = await sb
        .from("delivery_rules")
        .select("min_subtotal,fee")
        .eq("customer_id", uid)
        .eq("is_active", true)
        .order("updated_at", { ascending: false })
        .order("id", { ascending: false })
        .limit(1)
        .maybeSingle();

      if (cust) {
        DELIVERY_RULE = cust;
        return;
      }
    }

    // 2) fallback to default rule
    const { data: def } = await sb
      .from("delivery_rules")
      .select("min_subtotal,fee")
      .is("customer_id", null)
      .eq("is_active", true)
      .order("updated_at", { ascending: false })
      .order("id", { ascending: false })
      .limit(1)
      .maybeSingle();

    if (def) DELIVERY_RULE = def;
  } catch (_) {}
}


  function pickUnitPrice(row){
    const qty = pickQty(row);
    const retail = Number(row.unit_price ?? row.price ?? row.unitPrice ?? 0) || 0;
    const wholesale = Number(row.wholesale_price ?? row.wholesalePrice ?? 0) || 0;

    const th = Number(WHOLESALE_THRESHOLD || 50) || 50;
    if (qty >= th && wholesale > 0) return wholesale;

    return retail;
  }
  function pickName(row){
    return row.product_name ?? row.name ?? row.product_id ?? "Item";
  }


  async function loadWholesaleThreshold(sb, userId){
    try {
      const { data, error } = await sb
        .from("profiles")
        .select("wholesale_qty_threshold")
        .eq("id", userId)
        .maybeSingle();

      if (error) return 50;

      const v = Number(data?.wholesale_qty_threshold);
      return (Number.isFinite(v) && v >= 1) ? v : 50;
    } catch (e) {
      return 50;
    }
  }


  async function loadCustomerTier(sb, userId){
    try {
      const { data, error } = await sb
        .from("profiles")
        .select("tier")
        .eq("id", userId)
        .maybeSingle();

      if (error) return "standard";
      const t = String(data?.tier || "standard").trim().toLowerCase();
      return t || "standard";
    } catch (e) {
      return "standard";
    }
  }

  function applyPaymentMethodOptions(tier){
    const sel = document.getElementById("paymentMethod");
    if (!sel) return;

    const t = String(tier || "standard").trim().toLowerCase();
    const allowPayLater = (t === "std_pay_later" || t === "gold" || t === "platinum");

    // Reset styling (in case tier changed)
    sel.disabled = false;
    sel.style.appearance = "";
    sel.style.webkitAppearance = "";
    sel.style.mozAppearance = "";
    sel.style.backgroundImage = "";
    sel.style.pointerEvents = "";
    sel.style.paddingRight = "";

    const prev = String(sel.value || "").trim() || "pay_now";

    // Rebuild options
    sel.innerHTML = "";

    const optNow = document.createElement("option");
    optNow.value = "pay_now";
    optNow.textContent = "Pay now";
    sel.appendChild(optNow);

    if (allowPayLater) {
      const optLater = document.createElement("option");
      optLater.value = "pay_later";
      optLater.textContent = "Pay later at delivery";
      sel.appendChild(optLater);

      sel.value = (prev === "pay_later") ? "pay_later" : "pay_now";
      sel.disabled = false;
      return;
    }

    // STANDARD: Pay now only + hide arrow
    sel.value = "pay_now";
    sel.disabled = true;

    sel.style.appearance = "none";
    sel.style.webkitAppearance = "none";
    sel.style.mozAppearance = "none";
    sel.style.backgroundImage = "none";
    sel.style.pointerEvents = "none";
    sel.style.paddingRight = "12px";
  }

  function getImagePath(name) {
    // Logic updated to use a comprehensive map for the provided image file names,
    // ensuring 100% accuracy for the products in the catalogue.
    
    // 1. Create a clean slug from the product name (e.g., "Fortress Mid-Wrap (12")" -> "fortress-mid-wrap-12")
    let slug = String(name)
      .toLowerCase()
      .replace(/["']/g, '') // Remove quotes
      .replace(/[\(\)]/g, '') // Remove parentheses
      .replace(/[^a-z0-9\s-]/g, '') // Remove other non-alphanumeric, non-space, non-hyphen characters
      .trim()
      .replace(/\s+/g, '-'); // Replace spaces with hyphens

    // 2. Map the slug to the exact image file name provided by the user.
    // The keys are the slugs, and the values are the base image names (without .png).
    const imageMap = {
        "colossus-heavy-duty-20": "colossus-heavy-20",
        "colossus-max-load-20": "colossus-max-20",
        "flexlite-mid-stretch-12": "flexlite-12",
        "flexlite-reinforced-14": "flexlite-14", // Corrected slug for "FlexLite Reinforced (14")"
        "flexlite-pro-stretch-18": "flexlite-18", // Corrected slug for "FlexLite Pro-Stretch (18")"
        "flexlite-max-stretch-20": "flexlite-20", // Corrected slug for "FlexLite Max-Stretch (20")"
        "fortress-mid-wrap-12": "fortress-12",
        "hot-melt-max-grip-2": "hotmelt-2", // Corrected slug for "Hot Melt Max-Grip (2")"
        "hot-melt-max-grip-3": "hotmelt-3", // Corrected slug for "Hot Melt Max-Grip (3")"
        "steadfast-all-purpose-18": "steadfast-18",
        "titan-heavy-wrap-14": "titan-14",
        "water-glue-clear-tape-2": "water-tape-2", // Corrected slug for "Water Glue Clear-Tape (2")"
        "water-glue-clear-tape-3": "water-tape-3", // Corrected slug for "Water Glue Clear-Tape (3")"
        // Add other known products from products.html for completeness
        "ultra-clear-tape-2": "ultraclear-tape-2",
        "ultra-clear-tape-3": "ultraclear-tape-3",
        "brown-packaging-tape-2": "brown-tape-2",
        "brown-packaging-tape-3": "brown-tape-3",
        "fragile-tape-3": "fragile-tape-3",
        "caution-tape-3": "caution-tape-3",
    };

    let baseName = imageMap[slug] || slug;
    
    // Final cleanup for any trailing hyphens
    baseName = baseName.replace(/-+$/, '');

    return baseName + ".png";
  }

  async function getActiveCartId(sb, userId){
    let { data: cart, error } = await sb
      .from("carts")
      .select("id")
      .eq("user_id", userId)
      .eq("status", "active")
      .maybeSingle();
    if (error) throw error;

    if (!cart) {
      const { data: newCart, error: newErr } = await sb
        .from("carts")
        .insert([{ user_id: userId, status: "active" }])
        .select("id")
        .single();
      if (newErr) throw newErr;
      cart = newCart;
    }
    return cart.id;
  }

  async function loadCart(){
    const sb = getSb();
    const msg = document.getElementById("cartMsg");
    const list = document.getElementById("cartList");

    if (!sb) { msg.textContent = "Auth not ready. Refresh the page."; return; }

    const { data: sessData } = await sb.auth.getSession();
    const session = sessData && sessData.session;
    if (!session) { msg.textContent = "Please sign in to view your cart."; return; }

    msg.textContent = "Loading...";
    list.innerHTML = "";

    const userId = session.user.id;

    // Tier controls payment options
    CUSTOMER_TIER = await loadCustomerTier(sb, userId);
    applyPaymentMethodOptions(CUSTOMER_TIER);

    WHOLESALE_THRESHOLD = await loadWholesaleThreshold(sb, userId);
await loadDeliveryRule(sb);


    let cartId;
    try {
      cartId = await getActiveCartId(sb, userId);
    } catch (e){
      console.error(e);
      msg.textContent = "Could not load cart.";
      setTotals(0);
      setCartCount(0);
      return;
    }

    const { data, error } = await sb
      .from("cart_items")
      .select("*")
      .eq("cart_id", cartId)
      .order("id", { ascending: true });

    if (error) { console.error(error); msg.textContent = "Could not load cart."; setTotals(0); setCartCount(0); return; }

    if (!data || data.length === 0) {
      msg.textContent = "Your cart is empty.";
      setTotals(0);
      setCartCount(0);
      return;
    }

    msg.textContent = "";
    let subtotal = 0;
    let totalQty = 0;

    data.forEach(row => {
      const qty = pickQty(row);
      const price = pickUnitPrice(row);
      subtotal += qty * price;
      totalQty += qty;

      const item = document.createElement("div");
      item.classList.add("cart-row");
      // Applying compact styles
      item.style.display = "flex";
      item.style.justifyContent = "space-between";
      item.style.alignItems = "center";
      item.style.gap = "8px";
      item.style.padding = "6px 8px"; // Further reduced padding
      item.style.border = "1px solid rgba(255,255,255,.08)";
      item.style.borderRadius = "8px"; // Further reduced border radius
      item.style.background = "rgba(0,0,0,.18)";

      const productName = pickName(row);
      const imagePath = getImagePath(productName);
      item.innerHTML = `
        <div style="display:flex; align-items:center; gap: 8px; min-width:180px;">
          <img src="${imagePath}" alt="${escapeHtml(productName)}" style="width: 32px; height: 32px; object-fit: contain; border-radius: 4px; background: #fff; padding: 2px;">
          <div>
            <div style="font-weight:600; font-size: 0.85rem;">${escapeHtml(productName)}</div> <!-- Further reduced font size -->
            <div style="opacity:.85;font-size:11px;">Unit: ${money(price)}</div> <!-- Further reduced font size -->
          </div>
        </div>

        <div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap;justify-content:flex-end;">
          <label style="opacity:.85;font-size:11px;">Qty</label> <!-- Further reduced font size -->
          <input class="cartQty" type="number" min="1" value="${qty}" style="width:50px;padding:3px 5px;border-radius:6px;border:1px solid rgba(255,255,255,.18);background:rgba(0,0,0,.2);color:#fff;font-size:0.8rem;" /> <!-- Further reduced size and padding -->
          <div style="min-width:70px;text-align:right;font-weight:600;font-size:0.85rem;">${money(qty*price)}</div> <!-- Further reduced font size and width -->
          <button class="btn btn-secondary removeBtn" type="button" style="padding: 0.2rem 0.5rem; font-size: 0.75rem;">Remove</button> <!-- Further reduced button size -->
        </div>
      `;

      item.querySelector(".cartQty").addEventListener("change", async (e) => {
        const newQty = Math.max(1, Number(e.target.value || 1));
        const patch = ("qty" in row) ? { qty: newQty } : { quantity: newQty };
        const { error: upErr } = await sb.from("cart_items").update(patch).eq("id", row.id).eq("cart_id", cartId);
        if (upErr) console.error(upErr);
        await loadCart();
      });

      item.querySelector(".removeBtn").addEventListener("click", async () => {
        const { error: delErr } = await sb.from("cart_items").delete().eq("id", row.id).eq("cart_id", cartId);
        if (delErr) console.error(delErr);
        await loadCart();
      });

      list.appendChild(item);
    });

    setTotals(subtotal);
    setCartCount(totalQty);
  }

  function setTotals(subtotal){
    // Conditional Delivery Fee Logic
  const DELIVERY_THRESHOLD = Number(DELIVERY_RULE.min_subtotal || 300);
const DELIVERY_FEE = Number(DELIVERY_RULE.fee || 0);
    const HST_RATE = 0.13;

    let deliveryFee = 0;
    if (subtotal > 0 && subtotal < DELIVERY_THRESHOLD) {
  deliveryFee = DELIVERY_FEE;
}
    
    // Delivery is subject to HST
    const taxableBase = subtotal + deliveryFee;
    const hst = taxableBase * HST_RATE;
    const total = taxableBase + hst;

    document.getElementById("subTotal").textContent = money(subtotal);
    document.getElementById("deliveryFee").textContent = money(deliveryFee);
    document.getElementById("hst").textContent = money(hst);
    document.getElementById("grandTotal").textContent = money(total);
  }

  function setCartCount(n){
    const el = document.getElementById("cartCount");
    if (el) el.textContent = String(n || 0);
  }

  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#39;");
  }

  async function clearCart(){
    const sb = getSb();
    if (!sb) return;
    const { data: sessData } = await sb.auth.getSession();
    if (!sessData || !sessData.session) { alert("Please sign in."); return; }

    const ok = confirm("Clear all items from your cart?");
    if (!ok) return;

    try {
      const cartId = await getActiveCartId(sb, sessData.session.user.id);
      const { error } = await sb.from("cart_items").delete().eq("cart_id", cartId);
      if (error) console.error(error);
    } catch (e){
      console.error(e);
    }

    await loadCart();
  }

  document.addEventListener("DOMContentLoaded", () => {
    const buyBtn = document.getElementById("buyNowBtn");
    const paySel = document.getElementById("paymentMethod");
    const checkoutMsg = document.getElementById("checkoutMsg");

    async function startCheckout() {
      try {
        if (checkoutMsg) checkoutMsg.textContent = "Processing...";
        const sb = getSb();
        if (!sb) { if (checkoutMsg) checkoutMsg.textContent = "Auth not ready. Refresh."; return; }

        const { data: sessData } = await sb.auth.getSession();
        const session = sessData && sessData.session;

        // Ensure payment options are correct for this customer tier
        try {
          const uid = session?.user?.id;
          if (uid) {
            CUSTOMER_TIER = await loadCustomerTier(sb, uid);
            applyPaymentMethodOptions(CUSTOMER_TIER);
          }
        } catch (e) {}

        // Customer info for invoice (minimal)
        const customerEmail = session.user.email;
        const customerName = session.user.user_metadata?.full_name || session.user.user_metadata?.name || customerEmail;

        // Fetch extra customer details (if you have a customers/profile table)
        let customerPhone = "";
        let customerAddress = "";
        let customerCity = "";
        let customerPostal = "";
        let customerCompany = "";

        try {
          // Try common profile tables/columns (safe if table/columns don't exist)
          const { data: profile } = await sb
            .from("customers")
            .select("full_name,name,email,phone,address,city,postal_code,postal,company")
            .eq("user_id", session.user.id)
            .maybeSingle();

          if (profile) {
            // Prefer DB values if present
            const dbName = profile.full_name || profile.name;
            if (dbName) {
              // override customerName only if it's better than email
              if (String(dbName).trim().length) {
                // keep local variable used below
                // eslint-disable-next-line no-unused-vars
              }
            }
            customerPhone = profile.phone || "";
            customerAddress = profile.address || "";
            customerCity = profile.city || "";
            customerPostal = profile.postal_code || profile.postal || "";
            customerCompany = profile.company || "";
          }
        } catch (err) {
          // ignore (profile table may not exist)
        }


        if (!session) { if (checkoutMsg) checkoutMsg.textContent = "Please sign in."; return; }

        const cartId = await getActiveCartId(sb, session.user.id);

        WHOLESALE_THRESHOLD = await loadWholesaleThreshold(sb, session.user.id);
await loadDeliveryRule(sb);


        const { data: items, error } = await sb.from("cart_items").select("*").eq("cart_id", cartId);
await Promise.all(items.map(async (row) => {
  if (!row.product_id) return;

  const { data: p } = await sb
    .from("products")
    .select("specification")
    .eq("id", row.product_id)
    .single();

  if (p?.specification) {
    await sb
      .from("cart_items")
      .update({ specification: p.specification })
      .eq("id", row.id);
  }
}));

// âœ… IMPORTANT: persist final unit prices so invoice matches cart
await Promise.all((items || []).map(async (row) => {
  const finalUnit = pickUnitPrice(row); // uses WHOLESALE_THRESHOLD (5 for this customer)
  if (!row?.id) return;
  await sb
    .from("cart_items")
    .update({ unit_price: finalUnit })
    .eq("id", row.id)
    .eq("cart_id", cartId);
}));


        if (error) throw error;
        if (!items || items.length === 0) { if (checkoutMsg) checkoutMsg.textContent = "Your cart is empty."; return; }

        let subtotal = 0;
        items.forEach(r => { const q = pickQty(r); const p = pickUnitPrice(r); subtotal += q * p; });

     const DELIVERY_THRESHOLD = Number(DELIVERY_RULE.min_subtotal || 300);
const DELIVERY_FEE = Number(DELIVERY_RULE.fee || 0);
        const HST_RATE = 0.13;
        const deliveryFee = (subtotal > 0 && subtotal < DELIVERY_THRESHOLD) ? DELIVERY_FEE : 0;
        const taxableBase = subtotal + deliveryFee;
        const hst = taxableBase * HST_RATE;
        const total = taxableBase + hst;

        const method = (paySel && paySel.value) ? paySel.value : "pay_now";

	// ===== STOCK CHECK (STRICT) =====

// Normalize product_id to UUID if needed (slug -> UUID) using cart item's name.
// Then do a STRICT stock check (NO stock deduction here).
const UUID_RE = /^[0-9a-fA-F-]{36}$/;

// 1) Normalize product_id to UUID (fix bad old cart data)
for (const r of (items || [])) {
  if (!r?.product_id) continue;

  if (UUID_RE.test(String(r.product_id))) continue;

  const lookupName = String(r.product_name || r.name || "").trim();
  if (!lookupName) {
    if (checkoutMsg) checkoutMsg.textContent =
      "We couldnâ€™t validate this cart item. Please remove it and add it again.";
    return;
  }

  const { data: prod, error: prodErr } = await sb
    .from("products")
    .select("id")
    .eq("name", lookupName)
    .maybeSingle();

  if (prodErr || !prod?.id) {
    if (checkoutMsg) checkoutMsg.textContent =
      "We couldnâ€™t match this item to a product: " + lookupName + ". Please remove it and add it again.";
    return;
  }

  await sb
    .from("cart_items")
    .update({ product_id: prod.id })
    .eq("id", r.id)
    .eq("cart_id", cartId);

  r.product_id = prod.id;
}

// 2) Fetch live stock for all products in cart (strict check, qty==stock is allowed)
const ids = Array.from(new Set((items || []).map(r => String(r.product_id)).filter(id => UUID_RE.test(id))));
if (!ids.length) {
  if (checkoutMsg) checkoutMsg.textContent =
    "Your cart has invalid items. Please remove them and add again.";
  return;
}

const { data: prods, error: prodsErr } = await sb
  .from("products")
  .select("id,name,stock_on_hand,is_active,deleted_at")
  .in("id", ids);

if (prodsErr || !prods) {
  if (checkoutMsg) checkoutMsg.textContent =
    "We couldnâ€™t validate stock right now. Please try again.";
  return;
}

const map = new Map(prods.map(p => [String(p.id), p]));

// 3) Validate each item against stock_on_hand (NO UUID shown to customer)
for (const r of (items || [])) {
  const pid = String(r.product_id || "");
  if (!UUID_RE.test(pid)) {
    const nm = String(r.product_name || r.name || "Item");
    if (checkoutMsg) checkoutMsg.textContent =
      "Please remove and re-add this item: " + nm;
    return;
  }

  const p = map.get(pid);
  const nm = String(p?.name || r.product_name || r.name || "Item");
  const q = Number(r.qty || r.quantity || 0);

  if (!p || p.deleted_at) {
    if (checkoutMsg) checkoutMsg.textContent =
      "This item is no longer available: " + nm;
    return;
  }

  if (!p.is_active) {
    if (checkoutMsg) checkoutMsg.textContent =
      "This item is currently unavailable: " + nm;
    return;
  }

  const stock = Number(p.stock_on_hand || 0);

  if (stock <= 0) {
    if (checkoutMsg) checkoutMsg.textContent =
      "Sold out: " + nm;
    return;
  }

  // IMPORTANT: qty == stock is allowed. Only block when qty > stock.
  if (q > stock) {
    if (checkoutMsg) checkoutMsg.textContent =
      "Insufficient stock for " + nm + ". Available: " + stock + ". Please reduce quantity.";
    return;
  }
}

// ===== END STOCK CHECK =====





        const token = session.access_token;

       // PAY NOW must NOT create invoice before payment
if (method === "pay_now") {
  const resp = await fetch("https://fgrjojxwevllnjdixiyd.supabase.co/functions/v1/stripe-paynow-session", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": `Bearer ${token}`
    },
  
body: JSON.stringify({
  cart_id: cartId,
  currency: "CAD",

  // âœ… needed to build invoice AFTER payment
  subtotal,
  delivery: deliveryFee,
  tax: hst,
  total,

  // âœ… full billing/delivery info for invoice + order email AFTER payment
  bill_to_name: customerName,
  bill_to_email: customerEmail,
  bill_to_phone: customerPhone,
  bill_to_address: customerAddress,
  bill_to_city: customerCity,
  bill_to_postal: customerPostal,
  bill_to_company: customerCompany,

  success_url: `${location.origin}/paynow-success.html?sid={CHECKOUT_SESSION_ID}`,
  cancel_url: `${location.origin}/cart.html`
})

  });

  const out = await resp.json().catch(() => ({}));
  if (!resp.ok || !out.ok || !out.url) throw new Error(out.error || "Could not start Stripe checkout");

  // DO NOT clear cart here. Do NOT send emails. Do NOT reduce stock.
  window.location.href = out.url;
  return;
}

// PAY LATER keeps existing behavior: create invoice immediately


const resp = await fetch("https://fgrjojxwevllnjdixiyd.supabase.co/functions/v1/create-invoice", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    "x-create-invoice-secret": "shrinxa_create_invoice_9f3a1c7b8d",
	"Authorization": `Bearer ${token}`
  },
  body: JSON.stringify({
    cart_id: cartId,
    payment_method: method,
    subtotal,
    delivery_fee: deliveryFee,
    hst,
    total,
    currency: "CAD",
    bill_to_name: customerName,
    bill_to_email: customerEmail,
    bill_to_phone: customerPhone,
    bill_to_address: customerAddress,
    bill_to_city: customerCity,
    bill_to_postal: customerPostal,
    bill_to_company: customerCompany
  })
});

const out2 = await resp.json().catch(() => ({}));
if (!resp.ok || !out2.ok) throw new Error(out2.error || "Could not create invoice");

await loadCart();
setCartCount(0);

window.location.href = `/invoice.html?id=${encodeURIComponent(out2.invoice_id)}`;
 
   
      } catch (e) {
        console.error(e);
        if (checkoutMsg) checkoutMsg.textContent = String(e && e.message ? e.message : e);
      }
    }

    if (buyBtn) buyBtn.addEventListener("click", startCheckout);

    const cont = document.getElementById("continueShoppingBtn");
    if (cont) cont.addEventListener("click", () => window.location.href = "products.html");

    const clr = document.getElementById("clearCartBtn");
    if (clr) clr.addEventListener("click", clearCart);

    loadCart();
  });
})();
</script>
</div>
<script>
// Products dropdown toggle (index.html)
document.addEventListener("DOMContentLoaded", () => {
  const toggle = document.querySelector(".nav-dropdown-toggle");
  const menu = document.querySelector(".nav-dropdown-menu");
  if (!toggle || !menu) return;

  const close = () => {
    menu.classList.remove("open");
    toggle.setAttribute("aria-expanded", "false");
  };

  toggle.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();
    const isOpen = menu.classList.toggle("open");
    toggle.setAttribute("aria-expanded", isOpen ? "true" : "false");
  });

  document.addEventListener("click", (e) => {
    if (!menu.contains(e.target) && !toggle.contains(e.target)) close();
  });

  window.addEventListener("keydown", (e) => {
    if (e.key === "Escape") close();
  });
});
</script>
<script>
/* === MOBILE MENU TOGGLE === */
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("mobileMenuBtn");
  const panel = document.getElementById("mobileMenuPanel");
  const prodBtn = document.getElementById("mobileProductsBtn");
  const prodSub = document.getElementById("mobileProductsSub");
  if(!btn || !panel) return;

  const closeAll = () => {
    panel.classList.remove("open");
    btn.setAttribute("aria-expanded", "false");
    panel.setAttribute("aria-hidden", "true");
    if(prodSub) prodSub.classList.remove("open");
    if(prodBtn) prodBtn.setAttribute("aria-expanded","false");
  };

  btn.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();
    const isOpen = panel.classList.toggle("open");
    btn.setAttribute("aria-expanded", isOpen ? "true" : "false");
    panel.setAttribute("aria-hidden", isOpen ? "false" : "true");
    if(!isOpen){
      if(prodSub) prodSub.classList.remove("open");
      if(prodBtn) prodBtn.setAttribute("aria-expanded","false");
    }
  });

  prodBtn && prodBtn.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();
    const isOpen = prodSub.classList.toggle("open");
    prodBtn.setAttribute("aria-expanded", isOpen ? "true" : "false");
  });

  document.addEventListener("click", (e) => {
    if(panel.classList.contains("open")){
      if(!panel.contains(e.target) && !btn.contains(e.target)) closeAll();
    }
  });

  window.addEventListener("keydown", (e) => {
    if(e.key === "Escape") closeAll();
  });

  panel.querySelectorAll("a").forEach(a => a.addEventListener("click", closeAll));
});
</script>
<script>
/* === CART PULSE LIKE INDEX (BUMP ON LOAD + ON COUNT CHANGE) === */
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("openCartBtn");
  const countEl = document.getElementById("cartCount");
  if(!btn || !countEl) return;
  const bump = () => { btn.classList.add("bump"); setTimeout(()=>btn.classList.remove("bump"), 320); };
  setTimeout(bump, 650);
  const mo = new MutationObserver(() => bump());
  mo.observe(countEl, { childList:true, characterData:true, subtree:true });
  window.addEventListener("pageshow", () => setTimeout(bump, 350));
});
</script>
<script src="/assets/analytics.js" defer></script>
</body>
</html>
