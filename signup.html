<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Create Account | Shrinxa</title>

  <style>
    /* RESET */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      width: 100%;
      overflow-x: hidden;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(1200px 600px at 20% 0%, #173a6b 0%, #070b16 60%, #040814 100%);
      color: #fff;
    }

    /* MAIN */
    main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 60px 24px;
      display: flex;
      justify-content: center;
    }

    .card {
      width: 100%;
      max-width: 520px;
      background: linear-gradient(180deg, #0e1f3c 0%, #0a1329 100%);
      border-radius: 18px;
      padding: 32px;
      box-shadow: 0 30px 80px rgba(0,0,0,0.55);
      border: 1px solid rgba(255,255,255,0.08);
    }

    .card h1 {
      font-size: 24px;
      margin-bottom: 6px;
    }

    .card p {
      font-size: 14px;
      color: #cbd6ff;
      margin-bottom: 24px;
    }

    form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px 16px;
    }

    .full {
      grid-column: 1 / -1;
    }

    label {
      font-size: 12px;
      color: #cfd7ff;
      margin-bottom: 6px;
      display: block;
    }

    input:not([type="checkbox"]), select {
      width: 100%;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      color: #fff;
      font-size: 14px;
    }

    input:not([type="checkbox"]):focus, select:focus {
      outline: none;
      border-color: #3ea6ff;
    }

    .checkbox {
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
      color: #cbd6ff;
      margin-top: 8px;
    }

    .actions {
      grid-column: 1 / -1;
      margin-top: 10px;
    }
    form button[type="submit"] {
      width: 100%;
      padding: 14px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(180deg, #3ea6ff 0%, #1b6fd6 100%);
      color: #041022;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
    }
    form button[type="submit"]:hover {
      filter: brightness(1.05);
    }

    .bottom-text {
      margin-top: 18px;
      font-size: 13px;
      color: #cbd6ff;
      text-align: center;
    }

    .bottom-text a {
      color: #3ea6ff;
      text-decoration: none;
    }

    /* FOOTER */
    footer {
      border-top: 1px solid rgba(255,255,255,0.08);
      padding: 24px;
      text-align: center;
      font-size: 13px;
      color: #9fb2ff;
    }

    @media (max-width: 600px) {
      form {
        grid-template-columns: 1fr;
      }
    }
  
    /* FIX 1: Dropdown (select/option) white background in some browsers */
    select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-color: rgba(255,255,255,0.06);
      color: #fff;
    }
    select option {
      background-color: #0a1329;
      color: #fff;
    }

    /* FIX 2: Browser autofill turning inputs white (Chrome/Edge) */
    input:-webkit-autofill,
    input:-webkit-autofill:hover,
    input:-webkit-autofill:focus,
    textarea:-webkit-autofill,
    textarea:-webkit-autofill:hover,
    textarea:-webkit-autofill:focus,
    select:-webkit-autofill,
    select:-webkit-autofill:hover,
    select:-webkit-autofill:focus {
      -webkit-text-fill-color: #fff !important;
      transition: background-color 9999s ease-in-out 0s;
      box-shadow: 0 0 0px 1000px rgba(255,255,255,0.06) inset !important;
      border: 1px solid rgba(255,255,255,0.12) !important;
      caret-color: #fff !important;
    }

  </style>

<style>

    :root {
      --bg: #050914;
      --bg-alt: #0b1224;
      --accent: #1ea6ff;
      --accent-soft: rgba(30,166,255,0.12);
      --accent-strong: #0b84d1;
      --text-main: #f5f7fb;
      --text-muted: #b6bfd8;
      --card-bg: #111729;
      --border-subtle: #20273b;
      --danger: #ff4e6a;
      --success: #4cd964;
    }
    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #16345e 0, #050914 55%);
      color: var(--text-main);
      line-height: 1.5;
    }
    a { color: inherit; text-decoration: none; }
    img { max-width: 100%; display: block; }

    header {
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(18px);
      background: linear-gradient(90deg, rgba(5,9,20,0.96), rgba(8,16,40,0.96));
      border-bottom: 1px solid rgba(46,56,86,0.8);
    }
    .nav-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0.75rem 1.25rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1.25rem;
    }
    .nav-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .nav-logo {
      width: 44px;
      height: 44px;
      border-radius: 999px;
      overflow: hidden;
      box-shadow: 0 0 0 2px rgba(30,166,255,0.35);
      background: #ffffff;
      padding: 4px;
    }
    .nav-logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    .nav-brand-text {
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }
    .nav-brand-text strong {
      letter-spacing: 0.14em;
      font-size: 0.9rem;
    }
    .nav-brand-text span {
      font-size: 0.75rem;
      color: var(--text-muted);
    }
    .nav-links {
      display: flex;
      gap: 1.25rem;
      font-size: 0.9rem;
      color: var(--text-muted);
      align-items: center;
    }
    .nav-links a {
      position: relative;
      padding-bottom: 0.15rem;
    }
    .nav-links a::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--accent), #47e7ff);
      border-radius: 999px;
      transition: width 0.2s ease-out;
    }
    .nav-links a:hover::after {
      width: 100%;
    }
    .cart-chip {
      color: #f5f7fb;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.35rem 0.9rem;
      border-radius: 999px;
      background: rgba(12,25,52,0.95);
      border: 1px solid rgba(71,143,255,0.7);
      box-shadow: 0 0 0 1px rgba(16,85,204,0.4);
      font-size: 0.8rem;
      cursor: pointer;
      white-space: nowrap;
    }
    .cart-chip span.badge {
      color: #001225;
      min-width: 20px;
      height: 20px;
      border-radius: 999px;
      background: var(--accent);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 600;
      color: #001225;
    }

    main {

</style>
<style>
/* === HEADER BRAND UPGRADE (LOGO + NAME) === */
.nav-left{
  gap: 0.95rem;
}
.nav-logo{
  position: relative;
  box-shadow:
    0 0 0 2px rgba(30,166,255,0.45),
    0 14px 32px rgba(30,166,255,0.22),
    0 0 0 1px rgba(255,255,255,0.08) inset;
}
.nav-logo::after{
  content:"";
  position:absolute;
  inset:-10px;
  border-radius:999px;
  background: radial-gradient(circle at 30% 30%, rgba(71,231,255,0.28), transparent 55%),
              radial-gradient(circle at 70% 70%, rgba(111,66,193,0.22), transparent 60%);
  filter: blur(10px);
  opacity: .75;
  z-index:-1;
}
.nav-brand-text strong{
  font-size: 1.05rem;
  letter-spacing: 0.22em;
  background: linear-gradient(90deg, #39c9ff, #e1f5ff);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  text-shadow: 0 10px 24px rgba(0,0,0,0.45);
}
.nav-brand-text span{
  font-size: 0.78rem;
  color: rgba(182,191,216,0.92);
  letter-spacing: 0.02em;
}

/* Mobile: make brand feel premium + keep readable */
@media (max-width: 820px){
  .nav-inner{
    gap: 0.85rem;
  }
  .nav-logo{
    width: 46px;
    height: 46px;
  }
  .nav-brand-text strong{
    font-size: 1.02rem;
    letter-spacing: 0.18em;
  }
  .nav-brand-text span{
    font-size: 0.76rem;
  }
}

/* === HAMBURGER ICON: STACK BARS VERTICALLY === */
.mobile-menu-btn{
  flex-direction: column !important;
  gap: 5px !important;
}
</style>
<style>
/* === BRAND MOTION (LOGO + NAME) === */
@media (prefers-reduced-motion: no-preference) {
  .nav-left {
    position: relative;
  }

  .nav-logo {
    animation: brandGlow 3.8s ease-in-out infinite;
    transform-origin: center;
  }

  .nav-logo img {
    animation: brandFloat 4.6s ease-in-out infinite;
    transform-origin: center;
  }

  .nav-brand-text strong {
    position: relative;
  }

  .nav-brand-text strong::after{
    content:"";
    position:absolute;
    left:-8px;
    right:-8px;
    bottom:-2px;
    height:2px;
    border-radius:999px;
    background: linear-gradient(90deg, rgba(71,231,255,0), rgba(71,231,255,0.9), rgba(71,231,255,0));
    opacity:.0;
    animation: brandUnderline 3.8s ease-in-out infinite;
  }

  @keyframes brandGlow {
    0%,100% {
      box-shadow:
        0 0 0 2px rgba(30,166,255,0.45),
        0 14px 32px rgba(30,166,255,0.22),
        0 0 0 1px rgba(255,255,255,0.08) inset;
      filter: brightness(1);
      transform: translateY(0) scale(1);
    }
    50% {
      box-shadow:
        0 0 0 2px rgba(71,231,255,0.70),
        0 18px 46px rgba(71,143,255,0.32),
        0 0 0 1px rgba(255,255,255,0.10) inset;
      filter: brightness(1.05);
      transform: translateY(-1px) scale(1.02);
    }
  }

  @keyframes brandFloat {
    0%,100% { transform: translateY(0) scale(1); }
    50% { transform: translateY(-1.5px) scale(1.01); }
  }

  @keyframes brandUnderline {
    0%,100% { opacity: 0.05; transform: scaleX(0.6); }
    50% { opacity: 0.75; transform: scaleX(1); }
  }
}

/* Hover bonus (desktop only) */
@media (hover:hover) and (pointer:fine){
  .nav-left:hover .nav-logo{
    filter: brightness(1.08);
    transform: translateY(-2px) scale(1.03);
  }
}
</style>
<style>
/* === CART PULSE LIKE INDEX (BUMP ANIMATION) === */
.cart-chip.bump{ animation: cartBump .28s ease-out; }
@keyframes cartBump{
  0%{transform:scale(1)}
  45%{transform:scale(1.12)}
  100%{transform:scale(1)}
}
</style>
<style>
/* === CREATE ACCOUNT SHINE (BEST VISUAL) === */
@media (prefers-reduced-motion: no-preference){
  #submitBtn{
    position: relative;
    overflow: hidden;
  }
  #submitBtn::after{
    content:"";
    position:absolute;
    top:-60%;
    left:-40%;
    width:40%;
    height:220%;
    transform: rotate(18deg);
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.70), transparent);
    opacity:0;
    animation: createShine 4.9s ease-in-out infinite;
  }
  @keyframes createShine{
    0%,76%,100%{opacity:0; transform: translateX(-140%) rotate(18deg);}
    82%{opacity:0.9;}
    92%{opacity:0.9; transform: translateX(420%) rotate(18deg);}
    96%{opacity:0;}
  }
  #submitBtn:disabled::after{ display:none; }
}
</style>


<style>
/* === FORCE HEADER TO MATCH index.html (SIGNUP) â€” DESKTOP ONLY === */
@media (min-width: 821px){
header .nav-links{
  display:flex !important;
  gap: 1.25rem !important;
  font-size: 0.9rem !important;
  color: var(--text-muted) !important;
  align-items:center !important;
}
header .nav-links a{
  position: relative !important;
  padding-bottom: 0.15rem !important;
  color: var(--text-muted) !important;
  background: none !important;
  border: none !important;
  box-shadow: none !important;
}
header .nav-links a::after{
  content: "" !important;
  position: absolute !important;
  left: 0 !important;
  bottom: 0 !important;
  width: 0 !important;
  height: 2px !important;
  background: linear-gradient(90deg, var(--accent), #47e7ff) !important;
  border-radius: 999px !important;
  transition: width 0.2s ease-out !important;
}
header .nav-links a:hover::after{ width: 100% !important; }

/* Products dropdown EXACT behavior */
header .nav-dropdown{ position: relative !important; display:flex !important; align-items:center !important; }
header .nav-dropdown-toggle{
  background: none !important;
  border: none !important;
  color: var(--text-muted) !important;
  font: inherit !important;
  cursor: pointer !important;
  padding: 0 !important;
  display: flex !important;
  align-items: center !important;
  gap: 0.2rem !important;
}
header .nav-dropdown-toggle:hover{ color: var(--text-main) !important; }

header .nav-dropdown-menu{
  position: absolute !important;
  top: 150% !important;
  left: 0 !important;
  background: rgba(5,9,20,0.98) !important;
  border-radius: 0.75rem !important;
  padding: 0.4rem 0.35rem !important;
  box-shadow: 0 18px 40px rgba(0,0,0,0.55) !important;
  display: none !important;
  flex-direction: column !important;
  min-width: 180px !important;
  z-index: 40 !important;
  border: 1px solid rgba(65,98,160,0.7) !important;
}
header .nav-dropdown-menu.open{ display: flex !important; }
header .nav-dropdown-item{
  display: block !important;
  background: none !important;
  border: none !important;
  color: var(--text-muted) !important;
  text-align: left !important;
  padding: 0.35rem 0.75rem !important;
  border-radius: 0.55rem !important;
  font-size: 0.85rem !important;
  cursor: pointer !important;
  white-space: nowrap !important;
}
header .nav-dropdown-item:hover{
  background: var(--accent-soft) !important;
  color: var(--text-main) !important;
}

/* Ensure no stray dropdown text ever shows under header */
header .nav-dropdown-menu:not(.open){ visibility: hidden !important; }
header .nav-dropdown-menu.open{ visibility: visible !important; }
}
</style>



<style>
/* === MOBILE HEADER MENU (RESTORED) === */
.mobile-menu-btn{
  display:none;
  width:42px;
  height:38px;
  border-radius: 12px;
  border: 1px solid rgba(71,143,255,0.6);
  background: rgba(12,25,52,0.75);
  box-shadow: 0 0 0 1px rgba(16,85,204,0.35);
  cursor:pointer;
  align-items:center;
  justify-content:center;
  flex-direction: column; /* bars on top of each other */
  gap: 5px;
}
.mobile-menu-btn .mm-bar{
  display:block;
  width:18px;
  height:2px;
  background: rgba(245,247,251,0.92);
  border-radius: 999px;
}

.mobile-menu-panel{
  display:none;
  position: fixed;
  top: 68px;
  left: 0;
  right: 0;
  z-index: 30;
  padding: 10px 12px 14px;
  background: linear-gradient(180deg, rgba(5,9,20,0.98), rgba(8,16,40,0.98));
  border-bottom: 1px solid rgba(46,56,86,0.8);
  backdrop-filter: blur(18px);
}
.mobile-menu-panel.open{ display:block; }

.mobile-menu-inner{
  max-width: 1200px;
  margin: 0 auto;
  display:flex;
  flex-direction:column;
  gap: 10px;
}
.mobile-menu-inner a,
.mobile-menu-group-btn{
  color: var(--text-main);
  text-decoration:none;
  font-size: 0.95rem;
  padding: 12px 12px;
  border-radius: 14px;
  border: 1px solid rgba(63,87,145,0.65);
  background: rgba(8,16,40,0.75);
}
.mobile-menu-inner a:hover,
.mobile-menu-group-btn:hover{
  border-color: rgba(87,186,255,0.95);
}
.mobile-menu-group{ display:flex; flex-direction:column; gap:10px; }
.mobile-menu-group-btn{
  width:100%;
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
}
.mobile-menu-sub{
  display:none;
  flex-direction:column;
  gap: 8px;
  padding-left: 6px;
}
.mobile-menu-sub.open{ display:flex; }
.mobile-menu-sub a{
  background: rgba(5,12,32,0.8);
  border-color: rgba(63,87,145,0.55);
  font-size: 0.92rem;
}

@media (max-width: 820px){
  .nav-links{ display:none !important; }
  .mobile-menu-btn{ display:inline-flex; }

  /* Keep everything INSIDE the screen (fix cart pushed right) */
  .nav-inner{
    padding: 0.65rem 0.9rem;
    gap: 0.6rem;
  }
  .nav-left{ min-width: 0; }
  .nav-brand-text{ min-width: 0; }
  .nav-brand-text span{ display: none; } /* hide subtitle on mobile to save space */
  .nav-brand-text strong{ white-space: nowrap; }

  .nav-right{
    min-width: 0;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 0.5rem;
    flex-wrap: wrap;           /* allows wrap instead of overflowing */
    row-gap: 6px;
  }

  /* Make the user pill compact */
  #user-greeting{ display:none !important; }
  .user-menu-toggle{
    max-width: 170px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    padding: 0.28rem 0.6rem;
    font-size: 0.78rem;
  }

  /* Make cart compact but keep blue style */
  .cart-chip{
    padding: 0.32rem 0.65rem;
    font-size: 0.78rem;
    max-width: 140px;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .nav-logo{ width:46px; height:46px; }
}
</style>

</head>
<body>
<header>
<div class="nav-inner">
<div class="nav-left">
<div class="nav-logo">
<img alt="Shrinxa logo" src="shrinxa_transparent_4000px.png"/>
</div>
<div class="nav-brand-text">
<strong>SHRINXA</strong>
<span>Premium Packaging Solutions</span>
</div>
</div>
<nav class="nav-links">
<a class="nav-anchor nav-home" data-nav="home" href="index.html">Home</a>
<div class="nav-dropdown">
  <button class="nav-dropdown-toggle" type="button" aria-haspopup="true" aria-expanded="false">
    Products <span aria-hidden="true">â–¾</span>
  </button>
  <div class="nav-dropdown-menu" role="menu">
    <a class="nav-dropdown-item" role="menuitem" href="products.html?cat=all">All Products</a>
    <a class="nav-dropdown-item" role="menuitem" href="products.html?cat=stretch">Stretch Wrap</a>
    <a class="nav-dropdown-item" role="menuitem" href="products.html?cat=prestretch">Pre-Stretch Wrap</a>
    <a class="nav-dropdown-item" role="menuitem" href="products.html?cat=tape">Tape Rolls</a>
  </div>
</div>
<a class="nav-anchor nav-about" data-nav="about" href="about.html">About</a>
<a class="nav-anchor nav-delivery" data-nav="delivery" href="delivery.html">Delivery</a>
<a class="nav-anchor nav-contact" data-nav="contact" href="contactus.html">Contact us</a>

<a class="nav-anchor nav-signin" data-nav="signin" href="login.html">Sign in</a></nav>
<div class="nav-right">
<button class="mobile-menu-btn" id="mobileMenuBtn" type="button" aria-label="Open menu" aria-expanded="false">
  <span class="mm-bar"></span>
  <span class="mm-bar"></span>
  <span class="mm-bar"></span>
</button>
<div class="user-menu" id="user-menu" style="display:none; position:relative;"><button class="user-menu-toggle" id="userMenuToggle" type="button"><span id="userMenuName">Profile</span> â–¾</button><div class="user-menu-dropdown" id="userMenuDropdown"><button class="user-menu-item" type="button" data-action="profile">Profile</button><button class="user-menu-item" type="button" data-action="history">Purchase History</button><button class="user-menu-item" type="button" data-action="signout">Sign out</button></div></div><div class="user-greeting" id="user-greeting"></div><button class="cart-chip" id="openCartBtn">
      ðŸ§º Cart <span class="badge" id="cartCount">0</span>
</button></div></div>
</header>

<div class="mobile-menu-panel" id="mobileMenuPanel" aria-hidden="true">
  <div class="mobile-menu-inner">
    <a href="index.html">Home</a>
    <div class="mobile-menu-group">
      <button class="mobile-menu-group-btn" type="button" id="mobileProductsBtn" aria-expanded="false">
        Products <span aria-hidden="true">â–¾</span>
      </button>
      <div class="mobile-menu-sub" id="mobileProductsSub">
        <a href="products.html?cat=all">All Products</a>
        <a href="products.html?cat=stretch">Stretch Wrap</a>
        <a href="products.html?cat=prestretch">Pre-Stretch Wrap</a>
        <a href="products.html?cat=tape">Tape Rolls</a>
      </div>
    </div>
    <a href="about.html">About</a>
    <a href="delivery.html">Delivery</a>
    <a href="contactus.html">Contact us</a>
    <a class="nav-signin" href="login.html">Sign in</a>
  </div>
</div>




<main>
  <div class="card">
    <h1>Create a new account</h1>
    <p>All fields are required. This helps us prepare quotes and delivery faster.</p>

    <!-- Status message (no layout change; uses same spacing as your paragraph) -->
    <div id="statusMsg" style="display:none; margin: -10px 0 18px; font-size:13px; color:#cbd6ff;"></div>

    <form id="signupForm">
      <div>
        <label>Full Name</label>
        <input id="full_name" type="text" autocomplete="name" required>
      </div>
      <div>
        <label>Company Name</label>
        <input id="company_name" type="text" autocomplete="organization" required>
      </div>

      <div>
        <label>Email</label>
        <input id="email" type="email" autocomplete="email" required>
      </div>
      <div>
        <label>Phone Number</label>
        <input id="phone" type="tel" autocomplete="tel" required>
      </div>

      <div class="full">
        <label>Address</label>
        <input id="address" type="text" autocomplete="street-address" required>
      </div>

      <div>
        <label>City</label>
        <input id="city" type="text" autocomplete="address-level2" required>
      </div>
      <div>
        <label>Province</label>
        <select id="province" required>
          <option value="">Select Province</option>
          <option>Ontario</option>
          <option>Quebec</option>
          <option>British Columbia</option>
          <option>Alberta</option>
        </select>
      </div>

      <div>
        <label>Password</label>
        <input id="password" type="password" autocomplete="new-password" required>
      </div>
      <div>
        <label>Confirm Password</label>
        <input id="confirm_password" type="password" autocomplete="new-password" required>
      </div>

      <div class="checkbox">
        <input id="consent" type="checkbox" required>
        <span>I agree that Shrinxa may contact me with quotes and recommendations.</span>
      </div>

      <div class="actions">
        <button id="submitBtn" type="submit">Create account</button>
      </div>
    </form>

    <div class="bottom-text">
      Already have an account? <a href="login.html">Sign in</a>
    </div>
  </div>
</main>

<footer>
  Â© 2025 Shrinxa. All rights reserved.
</footer>

<!-- Supabase JS (required) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- Your existing auth.js (DO NOT change it) -->
<script src="auth.js"></script>

<script>
  (function () {
    const form = document.getElementById("signupForm");
    const btn = document.getElementById("submitBtn");
    const statusMsg = document.getElementById("statusMsg");

    function setStatus(text, isError) {
      if (!statusMsg) return;
      statusMsg.style.display = "block";
      statusMsg.style.color = isError ? "#ffb4b4" : "#cbd6ff";
      statusMsg.textContent = text;
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      try {
        if (!window.Auth || !window.Auth.signUpWithProfile) {
          setStatus("Auth is not loaded. Make sure supabase-js and auth.js are included.", true);
          return;
        }

        const full_name = document.getElementById("full_name").value.trim();
        const company = document.getElementById("company_name").value.trim();
        const email = document.getElementById("email").value.trim();
        const phone = document.getElementById("phone").value.trim();
        const address = document.getElementById("address").value.trim();
        const city = document.getElementById("city").value.trim();
        const province = document.getElementById("province").value.trim();
        const password = document.getElementById("password").value;
        const confirm_password = document.getElementById("confirm_password").value;

        if (password !== confirm_password) {
          setStatus("Passwords do not match.", true);
          return;
        }

        btn.disabled = true;
        btn.textContent = "Creating account...";

        const { user, session } = await window.Auth.signUpWithProfile({
          email,
          password,
          full_name,
          company,
          phone,
          address,
          city,
          province
        });

        // Supabase behavior:
        // - New signup with email confirmation ON: session can be null (user exists, identities usually has 1)
        // - Email already registered: session is null and user.identities is usually empty
        const identities = (user && Array.isArray(user.identities)) ? user.identities : [];

        // Email already exists â†’ show error and stay on signup page (NO redirect)
        // (Supabase returns session=null and user.identities=[] for existing emails)
        if (!session && identities.length === 0) {
          setStatus("This email is already registered. Please sign in instead.", true);
          return;
        }

        // New account created (with or without session) â†’ show message then redirect to login
        // If email confirmation is required, session can be null but identities will usually have 1.
        if (!session) {
          setStatus("Account created. Please check your email to confirm, then sign in.", false);
        } else {
          setStatus("Account created successfully. Redirecting to sign in...", false);
        }

        setTimeout(() => {
          window.location.href = "login.html";
        }, 1200);

      } catch (err) {
        const msg = (err && (err.message || err.error_description)) ? (err.message || err.error_description) : "Signup failed.";
        setStatus(msg, true);
      } finally {
        btn.disabled = false;
        btn.textContent = "Create account";
      }
    });
  })();
</script>

<script>
// Products dropdown toggle (index.html)
document.addEventListener("DOMContentLoaded", () => {
  const toggle = document.querySelector(".nav-dropdown-toggle");
  const menu = document.querySelector(".nav-dropdown-menu");
  if (!toggle || !menu) return;

  const close = () => {
    menu.classList.remove("open");
    toggle.setAttribute("aria-expanded", "false");
  };

  toggle.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();
    const isOpen = menu.classList.toggle("open");
    toggle.setAttribute("aria-expanded", isOpen ? "true" : "false");
  });

  document.addEventListener("click", (e) => {
    if (!menu.contains(e.target) && !toggle.contains(e.target)) close();
  });

  window.addEventListener("keydown", (e) => {
    if (e.key === "Escape") close();
  });
});
</script>
<script>
(() => {
  const SUPABASE_URL = "https://fgrjojxwevllnjdixiyd.supabase.co";
  const SUPABASE_ANON_KEY = "sb_publishable_k5D9JKO5lMCHlju-WhlSAQ_XEiEruT_";
  const CART_COUNT_URL = `${SUPABASE_URL}/functions/v1/cart-count`;

  const setCartCount = (n) => {
    const el = document.getElementById("cartCount");
    if (!el) return;
    const v = Number(n || 0);
    el.textContent = String(Number.isFinite(v) ? v : 0);
  };

  async function getClient() {
    if (window.supabaseClient?.auth) return window.supabaseClient;
    if (window._supabase?.auth) return window._supabase;
    if (window.supabase?.auth && !window.supabase.createClient) return window.supabase; // already a client
    if (window.supabase?.createClient) {
      // Create a client using known URL + anon key (no auth.js edits)
      window._supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      return window._supabase;
    }
    return null;
  }

  async function getAccessToken() {
    const sb = await getClient();
    if (!sb?.auth?.getSession) return null;
    try {
      const { data } = await sb.auth.getSession();
      return data?.session?.access_token || null;
    } catch {
      return null;
    }
  }

  async function refreshCartCountFromServer() {
    try {
      const token = await getAccessToken();
      if (!token) return setCartCount(0);

      const r = await fetch(CART_COUNT_URL, {
        method: "GET",
        headers: {
          apikey: SUPABASE_ANON_KEY,
          Authorization: `Bearer ${token}`,
        },
      });

      if (!r.ok) return;
      const j = await r.json();
      setCartCount(j?.cart_count ?? j?.count ?? 0);
    } catch {}
  }

  // Cart button should open cart.html
  document.addEventListener("DOMContentLoaded", () => {
    const cartBtn = document.getElementById("openCartBtn");
    if (cartBtn) {
      cartBtn.addEventListener("click", () => {
        window.location.href = "cart.html";
      });
    }
  });

  // Load cart count on open and when returning via back button
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", refreshCartCountFromServer);
  } else {
    refreshCartCountFromServer();
  }
  window.addEventListener("pageshow", refreshCartCountFromServer);
})();
</script>
<script>
/* === CART PULSE LIKE INDEX (BUMP ON LOAD + ON COUNT CHANGE) === */
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("openCartBtn");
  const countEl = document.getElementById("cartCount");
  if(!btn || !countEl) return;

  const bump = () => {
    btn.classList.add("bump");
    setTimeout(() => btn.classList.remove("bump"), 320);
  };

  setTimeout(bump, 650);

  const mo = new MutationObserver(() => bump());
  mo.observe(countEl, { childList:true, characterData:true, subtree:true });

  window.addEventListener("pageshow", () => setTimeout(bump, 350));
});
</script>


<script>
/* === MOBILE MENU TOGGLE === */
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("mobileMenuBtn");
  const panel = document.getElementById("mobileMenuPanel");
  const prodBtn = document.getElementById("mobileProductsBtn");
  const prodSub = document.getElementById("mobileProductsSub");
  if(!btn || !panel) return;

  const closeAll = () => {
    panel.classList.remove("open");
    btn.setAttribute("aria-expanded", "false");
    panel.setAttribute("aria-hidden", "true");
    if(prodSub) prodSub.classList.remove("open");
    if(prodBtn) prodBtn.setAttribute("aria-expanded","false");
  };

  btn.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();
    const isOpen = panel.classList.toggle("open");
    btn.setAttribute("aria-expanded", isOpen ? "true" : "false");
    panel.setAttribute("aria-hidden", isOpen ? "false" : "true");
    if(!isOpen){
      if(prodSub) prodSub.classList.remove("open");
      if(prodBtn) prodBtn.setAttribute("aria-expanded","false");
    }
  });

  prodBtn && prodBtn.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();
    const isOpen = prodSub.classList.toggle("open");
    prodBtn.setAttribute("aria-expanded", isOpen ? "true" : "false");
  });

  document.addEventListener("click", (e) => {
    if(panel.classList.contains("open")){
      if(!panel.contains(e.target) && !btn.contains(e.target)) closeAll();
    }
  });

  window.addEventListener("keydown", (e) => {
    if(e.key === "Escape") closeAll();
  });

  panel.querySelectorAll("a").forEach(a => a.addEventListener("click", closeAll));
});
</script>

</body>
</html>
