<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Admin – Clients</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background:#f6f7fb; }

    /* --- HEADER (same style as your admin files) --- */
    header { background:#111; }
    header a { color:#fff; text-decoration:none; opacity:.9; }
    header a:hover { opacity:1; text-decoration:underline; }
    .nav-links { gap:14px; flex-wrap:wrap; }

    /* --- PAGE LAYOUT (matches the mock you liked) --- */
    .page-wrap { padding: 18px 18px 28px; }
    .page-title { font-size: 28px; font-weight: 700; margin: 6px 0 14px; }

    .panel {
      background: #ffffff;
      border: 1px solid #d9dde6;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(20,32,60,0.06);
      overflow: hidden;
    }
    .panel-hd {
      padding: 12px 14px;
      border-bottom: 1px solid #e5e8ef;
      background: #f3f4f7;
      font-weight: 700;
    }
    .panel-bd { padding: 14px; }

    .muted { color:#6b7280; }
    .mini { font-size: 12px; }
    .input-compact { height: 38px; }

    .order-grid {
      display: grid;
      grid-template-columns: 1.05fr 0.95fr;
      gap: 14px;
      align-items: start;
    }

    .products-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    .prod-card {
      border: 1px solid #d9dde6;
      border-radius: 12px;
      padding: 12px;
      background: #fff;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items: center;
      min-height: 92px;
    }

    .badge-stock {
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #e8f5ff;
      border: 1px solid #bfe6ff;
      color: #0b5cab;
      font-weight: 700;
      display: inline-block;
    }

    .badge-low {
      background: #fff4db;
      border-color: #ffdca0;
      color: #8a5a00;
    }

    .qty-btn {
      width: 38px;
      height: 34px;
      border-radius: 8px;
      border: 1px solid #d0d5df;
      background: #f7f8fb;
      font-weight: 800;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
    }

    .qty-box {
      width: 54px;
      height: 34px;
      border-radius: 8px;
      border: 1px solid #d0d5df;
      background: #fff;
      text-align: center;
      font-weight: 700;
    }

    .order-table th, .order-table td { vertical-align: middle; }
    .order-table th { font-size: 13px; color:#4b5563; }
    .totals-row {
      display:flex;
      justify-content: space-between;
      padding: 6px 0;
      border-top: 1px solid #e5e8ef;
      margin-top: 8px;
    }
    .totals-row:first-of-type { border-top: none; margin-top: 0; }
    .totals-strong { font-size: 18px; font-weight: 800; }
  </style>
</head>

<body>
  <!-- HEADER (copied style from customers.html; only active link is Clients) -->
  <header class="py-3">
    <div class="container-fluid px-4 d-flex align-items-center gap-3">
      <div class="text-white fw-bold">Shrinxa Admin</div>

      <div class="d-flex nav-links">
        <a href="./dashboard.html">Dashboard</a>
        <a href="./orders.html">Orders</a>
        <a href="./customers.html">Customers</a>
        <a href="./clients.html" style="text-decoration:underline; opacity:1;">Clients</a>
        <a href="./products-admin.html">Products</a>
        <a href="./platinum.html">Platinum</a>
        <a href="./delivery-admin.html">Delivery Rules</a>
        <a href="./inventory.html">Inventory</a>
        <a href="./income.html">Income</a>
      </div>

      <div class="ms-auto d-flex align-items-center gap-2">
        <span id="adminEmail" class="text-white small"></span>
        <button id="logoutBtn" class="btn btn-sm btn-outline-light">Logout</button>
      </div>
    </div>
  </header>

  <div class="page-wrap">
    <div class="page-title">Clients</div>

    <div class="order-grid">
      <!-- LEFT COLUMN -->
      <div class="d-grid gap-3">
        <!-- Customer panel -->
        <div class="panel">
          <div class="panel-hd">Customer</div>
          <div class="panel-bd">
            <div class="d-flex gap-2 align-items-center flex-wrap">
              <select id="clientSelect" class="form-select input-compact" style="min-width: 360px;">
                <option value="">Select a customer…</option>
              </select>
              <button id="refreshClientsBtn" class="btn btn-primary">Refresh List</button>
            </div>

            <div class="mt-3">
              <button id="openCreateClientBtn" class="btn btn-success">
                + Create New Customer
              </button>
            </div>

            <div id="clientInfo" class="mt-3 p-3 rounded-3" style="background:#eef3f7; border:1px solid #d7dee8;">
              <div class="fw-bold">Customer ID: <span id="clientIdText" class="muted">—</span></div>
              <div class="muted mini">Address: <span id="clientAddressText">—</span></div>
            </div>

            <div id="clientStatus" class="mt-2 mini muted">Ready.</div>
          </div>
        </div>

        <!-- Products panel -->
        <div class="panel">
          <div class="panel-hd">Select Products</div>
          <div class="panel-bd">
            <div class="d-flex gap-2 flex-wrap">
              <input id="productSearch" class="form-control input-compact" placeholder="Search by name…" style="min-width: 280px;">
              <select id="productCategory" class="form-select input-compact" style="max-width: 220px;">
                <option value="all">All Categories</option>
              </select>
            </div>

            <div class="mt-3 products-grid" id="productsGrid">
              <!-- Product cards will be rendered here later -->
              <!-- Placeholder examples (static) so layout matches your image -->
              <div class="prod-card">
                <div>
                  <div class="fw-bold">Adhesive Tape A</div>
                  <div class="muted">$8.00 / unit</div>
                  <div class="mt-2"><span class="badge-stock">In Stock: 40</span></div>
                </div>
                <button class="btn btn-outline-primary">+</button>
              </div>

              <div class="prod-card">
                <div>
                  <div class="fw-bold">Shrink Wrap XL</div>
                  <div class="muted">$40.00 / unit</div>
                  <div class="mt-2"><span class="badge-stock badge-low">Low</span> <span class="muted mini">last 3</span></div>
                </div>
                <button class="btn btn-outline-primary">+</button>
              </div>

              <div class="prod-card">
                <div>
                  <div class="fw-bold">Adhesive Tape B</div>
                  <div class="muted">$9.00 / unit</div>
                  <div class="mt-2"><span class="badge-stock">In Stock: 30</span></div>
                </div>
                <button class="btn btn-outline-primary">+</button>
              </div>

              <div class="prod-card">
                <div>
                  <div class="fw-bold">Packing Foam Sheets</div>
                  <div class="muted">$10.00 / unit</div>
                  <div class="mt-2"><span class="badge-stock">In Stock: 12</span></div>
                </div>
                <button class="btn btn-outline-primary">+</button>
              </div>
            </div>

            <div class="mt-2 mini muted">
              Note: this page will later load products from your <code>products</code> table including live stock.
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT COLUMN -->
      <div class="panel">
        <div class="panel-hd">Order Builder</div>
        <div class="panel-bd">
          <table class="table table-sm order-table">
            <thead>
              <tr>
                <th style="width: 44%;">Product</th>
                <th style="width: 26%;">Quantity</th>
                <th style="width: 15%;">Price</th>
                <th style="width: 15%;">Total</th>
              </tr>
            </thead>
            <tbody id="orderLines">
              <!-- Placeholder lines so the layout matches the image -->
              <tr>
                <td>
                  <div class="fw-bold">Adhesive Tape A</div>
                  <div class="muted mini">$8.00 / unit</div>
                </td>
                <td>
                  <div class="d-flex align-items-center gap-2">
                    <span class="qty-btn">−</span>
                    <input class="qty-box" value="10" />
                    <span class="qty-btn">+</span>
                  </div>
                </td>
                <td>$8.00</td>
                <td class="fw-bold">$80.00</td>
              </tr>
              <tr>
                <td>
                  <div class="fw-bold">Shrink Wrap XL</div>
                  <div class="muted mini">$40.00 / unit</div>
                </td>
                <td>
                  <div class="d-flex align-items-center gap-2">
                    <span class="qty-btn">−</span>
                    <input class="qty-box" value="8" />
                    <span class="qty-btn">+</span>
                  </div>
                </td>
                <td>$40.00</td>
                <td class="fw-bold">$320.00</td>
              </tr>
            </tbody>
          </table>

          <div class="mt-2">
            <select id="deliveryRule" class="form-select input-compact" style="max-width: 260px;">
              <option value="">+ Add Delivery Fee</option>
              <option value="0">Delivery: $0</option>
              <option value="30">Delivery: $30</option>
            </select>
          </div>

          <div class="mt-3">
            <div class="totals-row"><div>Subtotal:</div><div id="subTotalText">$466.40</div></div>
            <div class="totals-row"><div>Delivery:</div><div id="deliveryText">$0.00</div></div>
            <div class="totals-row"><div>Tax (13% HST):</div><div id="taxText">$60.63</div></div>
            <div class="totals-row"><div class="totals-strong">Total:</div><div class="totals-strong" id="totalText">$527.03</div></div>
          </div>

          <button id="createInvoiceBtn" class="btn btn-success w-100 mt-3" style="height: 46px; font-weight: 800;">
            Create Invoice (Unpaid)
          </button>

          <div id="orderStatus" class="mt-2 mini muted">Ready.</div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { supabase } from "../supabaseClient.js";

    // header: email + logout (same pattern as customers.html)
    const adminEmailEl = document.getElementById("adminEmail");
    const logoutBtn = document.getElementById("logoutBtn");

    logoutBtn?.addEventListener("click", async () => {
      await supabase.auth.signOut();
      window.location.href = "../login.html";
    });

    async function initAdminHeader() {
      const { data: { user }, error } = await supabase.auth.getUser();
      if (!error && user?.email && adminEmailEl) adminEmailEl.textContent = user.email;
    }

    initAdminHeader();
  </script>
</body>
</html>
